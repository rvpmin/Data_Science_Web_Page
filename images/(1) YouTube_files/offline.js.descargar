(function(g){var window=this;'use strict';var uZK=function(k){var p=new g.jE("und",new g.th("Default","und",!0));p.captionTracks=k.captionTracks;return p},lSC=function(k){return new g.yu(function(p,t){var J=k.length,q=[];
if(J)for(var F=function(f,b){J--;q[f]=b;J==0&&p(q)},d=function(f){t(f)},S,U=0;U<k.length;U++)S=k[U],g.xse(S,g.xh(F,U),d);
else p(q)})},Gx=function(k){this.T=k},IR=function(){Gx.apply(this,arguments)},jmS=function(){IR.apply(this,arguments)},OBS=function(){IR.apply(this,arguments)},KkC=function(){IR.apply(this,arguments)},HBR=function(){IR.apply(this,arguments)},x6R=function(){IR.apply(this,arguments)},kcS=function(){IR.apply(this,arguments)},pZR=function(){Gx.apply(this,arguments)},tvC=function(){IR.apply(this,arguments)},JTJ=function(){IR.apply(this,arguments)},osC=function(){IR.apply(this,arguments)},q8L=function(){IR.apply(this,
arguments)},F1R=function(){IR.apply(this,arguments)},$MK=function(){IR.apply(this,arguments)},dMc=function(){IR.apply(this,arguments)},EsW=function(){IR.apply(this,arguments)},S8Q=function(){IR.apply(this,arguments)},UMR=function(){IR.apply(this,arguments)},fWS=function(){IR.apply(this,arguments)},bI9=function(){IR.apply(this,arguments)},NNR=function(){Gx.apply(this,arguments)},yTn=function(){IR.apply(this,arguments)},Y8n=function(){IR.apply(this,arguments)},TNL=function(){IR.apply(this,arguments)},
rTa=function(){IR.apply(this,arguments)},ZIW=function(){IR.apply(this,arguments)},CpS=function(){IR.apply(this,arguments)},ATW=function(){IR.apply(this,arguments)},mMC=function(){IR.apply(this,arguments)},Vvc=function(){IR.apply(this,arguments)},W1C=function(){Gx.apply(this,arguments)},DMq=function(){Gx.apply(this,arguments)},saC=function(){Gx.apply(this,arguments)},L1K=function(){IR.apply(this,arguments)},vsa=function(){IR.apply(this,arguments)},cTn=function(){IR.apply(this,arguments)},nsK=function(){IR.apply(this,
arguments)},wZL=function(){IR.apply(this,arguments)},iIc=function(){IR.apply(this,arguments)},QaJ=function(){IR.apply(this,arguments)},PpA=function(){IR.apply(this,arguments)},GcL=function(){IR.apply(this,arguments)},IWA=function(){IR.apply(this,arguments)},XZJ=function(){IR.apply(this,arguments)},Ro4=function(){IR.apply(this,arguments)},BNK=function(){IR.apply(this,arguments)},zo9=function(){IR.apply(this,arguments)},eoA=function(){IR.apply(this,arguments)},hoK=function(){IR.apply(this,arguments)},
aWq=function(){IR.apply(this,arguments)},Mv4=function(){IR.apply(this,arguments)},gs4=function(){IR.apply(this,arguments)},un9=function(){IR.apply(this,arguments)},lWc=function(){IR.apply(this,arguments)},jaA=function(){IR.apply(this,arguments)},OIa=function(){IR.apply(this,arguments)},K19=function(){IR.apply(this,arguments)},HI4=function(){IR.apply(this,arguments)},xM9=function(){IR.apply(this,arguments)},kR4=function(){Gx.apply(this,arguments)},p0K=function(){IR.apply(this,arguments)},t74=function(){IR.apply(this,
arguments)},JSq=function(){IR.apply(this,arguments)},ooJ=function(){IR.apply(this,arguments)},qQa=function(){IR.apply(this,arguments)},FB9=function(){IR.apply(this,arguments)},$SL=function(){IR.apply(this,arguments)},dSc=function(){IR.apply(this,arguments)},EoQ=function(){IR.apply(this,arguments)},SQS=function(){IR.apply(this,arguments)},USS=function(){IR.apply(this,arguments)},fRn=function(){IR.apply(this,arguments)},bOL=function(){IR.apply(this,arguments)},N1K=function(){IR.apply(this,arguments)},
ySS=function(){IR.apply(this,arguments)},YQa=function(){IR.apply(this,arguments)},T1W=function(){IR.apply(this,arguments)},rSS=function(){IR.apply(this,arguments)},ZOA=function(){IR.apply(this,arguments)},Cta=function(){IR.apply(this,arguments)},ASJ=function(){IR.apply(this,arguments)},mSQ=function(){IR.apply(this,arguments)},V74=function(){IR.apply(this,arguments)},WBa=function(){IR.apply(this,arguments)},DSQ=function(){IR.apply(this,arguments)},sVW=function(){IR.apply(this,arguments)},LB9=function(){IR.apply(this,
arguments)},voa=function(){IR.apply(this,arguments)},cSn=function(){IR.apply(this,arguments)},noq=function(){IR.apply(this,arguments)},w0K=function(k){k=k.key||k.id;
if(!k)throw Error("Entity key is missing");return k},iOA=function(){if(X7)return X7();
var k={};X7=g.OT("PersistentEntityStoreDb",{Sn:(k.EntityStore={f5:1},k.EntityAssociationStore={f5:2},k),shared:!1,upgrade:function(p,t){t(1)&&g.w6(g.D4(p,"EntityStore",{keyPath:"key"}),"entityType","entityType");t(2)&&(p=g.D4(p,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.w6(p,"byParentEntityKey","parentEntityKey"),g.w6(p,"byChildEntityKey","childEntityKey"))},
version:3});return X7()},QVS=function(k){return g.B7(iOA(),k)},Pt4=function(k){return g.B7((0,g.L$n)(),k)},RR=function(k){this.token=k},Bq=function(k,p){p=p===void 0?{}:p;
g.hm.call(this,g.vkR[k],Object.assign({},{name:"PESEncoderError",type:k},p));this.type=k;this.level="WARNING";Object.setPrototypeOf(this,Bq.prototype)},GRL=function(k){return new Bq("WRONG_DATA_TYPE",{nJ:k})},IRA=function(k){return k instanceof Error?new Bq("UNKNOWN_ENCODE_ERROR",{AO:k.message}):new Bq("UNKNOWN_ENCODE_ERROR")},X0c=function(k){return k instanceof Error?new Bq("UNKNOWN_DECODE_ERROR",{AO:k.message}):new Bq("UNKNOWN_DECODE_ERROR")},RzR=function(k,p){k=k instanceof Bq?k:p(k);
g.nV(k);throw k;},B1n=function(){},zzC=function(k,p,t){try{return k.N(p,t)}catch(J){RzR(J,IRA)}},ezR=function(k){k=(new TextEncoder).encode(k).subarray(0,16);
var p=new Uint8Array(16);p.set(k);return p},zx=function(k){this.T=k},aR4=function(k){var p=hza[k];
if(p)return p;g.wt(new g.hm("Entity model not found.",{entityType:k}))},M7c=function(k,p){this.T=k;
this.Y=p;this.N={}},ura=function(k,p){a:{k=goS(k.Y,p.version);
try{var t=k.Y(p.data,p.key);break a}catch(J){RzR(J,X0c)}t=void 0}return t},ey=function(k,p,t){return k.T.objectStore("EntityStore").get(p).then(function(J){if(J){if(t&&J.entityType!==t)throw Error("Incorrect entity type");
return ura(k,J)}})},h8=function(k,p,t){return t?(t=t.map(function(J){return ey(k,J,p)}),g.Z4.all(t)):k.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(p)).then(function(J){return J.map(function(q){return ura(k,q)})})},My=function(k,p,t){var J=w0K(p),q=goS(k.Y,1),F=Object.assign({},p);
return k.T.objectStore("EntityStore").get(J).then(function(d){if(d){if(d.entityType!==t)throw Error("Incorrect entity type");F.entityMetadata||(d=ura(k,d),F.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:J,
entityType:t,data:zzC(q,F,J),version:1};return g.Z4.all([g.v7(k.T.objectStore("EntityStore"),d),lRL(k,F,t)])}).then(function(){aR(k,J,t);
return J})},jVA=function(k,p,t){p=p.map(function(J){return My(k,J,t)});
return g.Z4.all(p)},gf=function(k,p,t){if(t==null?0:t.j0){var J=new Set;
return OOc(k,p,J).then(function(){for(var F=[],d=g.Z(J),S=d.next();!S.done;S=d.next())F.push(gf(k,S.value));return g.Z4.all(F).then(function(){})})}var q=g.uo(p).entityType;
return g.Z4.all([k.T.objectStore("EntityStore").delete(p),KBS(k,p)]).then(function(){aR(k,p,q)})},HOq=function(k,p){return g.GE(k.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(p)},function(t){return g.Z4.all([t.delete(),
KBS(k,t.cursor.primaryKey)]).then(function(){aR(k,t.cursor.primaryKey,p);return g.Q9(t)})})},xS9=function(k,p,t,J){var q=goS(k.Y,1);
return ey(k,p,J).then(function(F){if(F){F=g.bo(F,t);var d={key:p,entityType:J,data:zzC(q,F,p),version:1};return g.Z4.all([g.v7(k.T.objectStore("EntityStore"),d),lRL(k,F,J)])}}).then(function(){aR(k,p,J);
return p})},aR=function(k,p,t){var J=k.N[t];
J||(J=new Set,k.N[t]=J);J.add(p)},kTK=function(k,p,t){var J=w0K(p);
t=aR4(t);if(!t)return g.Z4.resolve([]);t=new t(p);k=k.T.objectStore("EntityAssociationStore");p=[];t=g.Z(t.Y());for(var q=t.next();!q.done;q=t.next())p.push(g.v7(k,{parentEntityKey:J,childEntityKey:q.value}));return g.Z4.all(p).then(function(F){return F.map(function(d){return d[1]})})},KBS=function(k,p){return k.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(p))},lRL=function(k,p,t){var J=w0K(p);
return KBS(k,J).then(function(){return kTK(k,p,t)})},OOc=function(k,p,t){if(t.has(p))return g.Z4.resolve(void 0);
t.add(p);return pCK(k,p).then(function(J){return k.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(p)).then(function(){return J})}).then(function(J){var q=g.Z4.resolve(void 0);
J=g.Z(J);for(var F=J.next(),d={};!F.done;d={Up:void 0},F=J.next())d.Up=F.value,q=q.then(function(S){return function(){return OOc(k,S.Up,t)}}(d));
return q}).then(function(){})},pCK=function(k,p){var t=k.T.objectStore("EntityAssociationStore");
return t.index("byParentEntityKey").getAll(IDBKeyRange.only(p)).then(function(J){var q=[];J=g.Z(J);for(var F=J.next();!F.done;F=J.next())F=F.value,q.push(t.index("byChildEntityKey").getAll(F.childEntityKey));return g.Z4.all(q)}).then(function(J){var q=[];
J=g.Z(J);for(var F=J.next();!F.done;F=J.next())F=F.value,F.length===1&&q.push(F[0].childEntityKey);return q})},ue=function(){},t4S=function(){this.T={};
this.T[0]=new ue;if(!g.TQ("aes_pes_encoder_killswitch")){var k=this.T;try{var p=g.au();var t=ezR(p);var J=new zx(new g.Z6(t),new g.rL(t))}catch(q){throw k=q instanceof Error?new Bq("KEY_CREATION_FAILED",{AO:q.message}):new Bq("KEY_CREATION_FAILED"),g.nV(k),k;}k[1]=J}},goS=function(k,p){p=p===void 0?0:p;
k=k.T[p];if(!k)throw p=new Bq("INVALID_ENCODER_VERSION",{nJ:p}),g.nV(p),p;return k},le=function(k,p){g.R.call(this);
this.token=k;this.T=p;this.observers=[];k=new g.B9.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.au());k.onmessage=this.Y.bind(this);this.channel=k},jy=function(k,p,t){var J,q,F,d;
return g.Q(function(S){if(S.T==1)return g.n(S,QVS(k.token),2);if(S.T!=3)return J=S.Y,g.n(S,g.Lz(J,["EntityStore","EntityAssociationStore"],p,function(U){q=new M7c(U,k.T);return t(q)}),3);
F=S.Y;q&&(d=q.N,Object.keys(d).length>0&&(k.channel.postMessage(d),JKa(k,d)));return S.return(F)})},Oz=function(k,p,t){return jy(k,{mode:"readwrite",
RO:!0},function(J){return My(J,p,t)})},oc9=function(k,p){return jy(k,{mode:"readwrite",
RO:!0},function(t){return jVA(t,p,"offlineOrchestrationActionWrapperEntity")})},qHA=function(k,p){return jy(k,{mode:"readwrite",
RO:!0},function(t){return gf(t,p)})},FSn=function(k){return jy(k,{mode:"readwrite",
RO:!0},function(p){return HOq(p,"videoPlaybackPositionEntity")})},K3=function(k,p,t){return jy(k,{mode:"readonly",
RO:!0},function(J){return ey(J,p,t)})},Hq=function(k,p,t){return jy(k,{mode:"readonly",
RO:!0},function(J){return h8(J,p,t)})},JKa=function(k,p){k=g.Z(k.observers);
for(var t=k.next();!t.done;t=k.next())t=t.value,t(p)},$JC=function(){var k,p,t;
return g.Q(function(J){if(J.T==1)return g.Aw(J,2),g.n(J,g.lr(),4);if(J.T!=2){k=J.Y;if(!k||!g.MI()||typeof g.B9.BroadcastChannel==="undefined")return J.return();p=new t4S;return J.return(new le(k,p))}t=g.W9(J);t instanceof Error&&g.nV(t);return J.return()})},xV=function(){dJ9||(dJ9=$JC());
return dJ9},EcS=function(k){var p;
k=(p=k.options)==null?void 0:p.persistenceOption;return k==="ENTITY_PERSISTENCE_OPTION_PERSIST"||k==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},SHQ=function(k){var p;
return g.Q(function(t){return t.T==1?g.n(t,xV(),2):(p=t.Y)?g.n(t,jy(p,"readwrite",function(J){for(var q={},F=g.Z(k),d=F.next(),S={};!d.done;S={It:void 0,t$:void 0},d=F.next())S.It=d.value,S.It.entityKey&&EcS(S.It)&&(S.t$=g.Vx(S.It.payload),d=void 0,S.It.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(U){return function(){return My(J,U.It.payload[U.t$],U.t$)}}(S)),S.It.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(U){return function(){return gf(J,U.It.entityKey)}}(S)),S.It.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(U){return function(){return xS9(J,U.It.entityKey,U.It.payload[U.t$],U.t$)}}(S)),d&&(q[S.It.entityKey]=q[S.It.entityKey]?q[S.It.entityKey].then(d):d()));
return g.Z4.all(Object.values(q))}),0):t.return()})},UJQ=function(k){var p;
return g.Q(function(t){if(t.T==1){p=k.mutations;if(!p||p.length<=0)return t.return();if(g.Kq){var J={type:"ENTITY_LOADED"};p!==void 0&&(J.payload=p);g.Kq.dispatch(J)}return g.n(t,SHQ(p),2)}p.length=0;g.CS(t)})},f0S=function(k){return k!==void 0},bZR=function(k){var p=g.VX();
p=Object.assign({},p);k=Object.assign({},k);for(var t in p)k[t]?(p[t]!==4&&(p[t]=k[t]),delete k[t]):p[t]!==2&&(p[t]=4);Object.assign(p,k);g.$gi(p);JSON.stringify(p);return p},N5L=function(k){var p,t;
return g.Q(function(J){if(J.T==1)return g.n(J,g.lr(),2);if(J.T!=3)return(p=J.Y)?g.n(J,g.sK(p),3):J.return();t=J.Y;return J.return(g.Lz(t,["index","media","captions"],{mode:"readwrite",RO:!0},function(q){var F=IDBKeyRange.bound(k+"|",k+"~");q=[q.objectStore("index").delete(F),q.objectStore("media").delete(F),q.objectStore("captions").delete(F)];return g.Z4.all(q).then(function(){})}))})},yKL=function(){var k,p;
return g.Q(function(t){if(t.T==1)return g.n(t,g.lr(),2);if(t.T!=3){k=t.Y;if(!k)throw g.TE("rvdfd");return g.n(t,g.sK(k),3)}p=t.Y;return t.return(g.Lz(p,["index","media"],{mode:"readwrite",RO:!0},function(J){var q={};return g.ir(J.objectStore("index"),{},function(F){var d=F.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),S=g.Z4.resolve(void 0);if(d){var U=d[1];d=d[2];q[U]=q[U]||{};var f;q[U][d]=g.fK_((f=F.getValue())==null?void 0:f.fmts)}else S=F.delete().then(function(){});
return g.Z4.all([g.Q9(F),S]).then(function(b){return g.Z(b).next().value})}).then(function(){for(var F={},d=g.Z(Object.keys(q)),S=d.next();!S.done;S=d.next()){S=S.value;
var U=q[S].v;F[S]=q[S].a&&U?1:2}var f=bZR(F);return g.zxj(J.objectStore("media"),{},function(b){var N=b.cursor.key.match(g.YxT);N&&F[N[1]]||J.objectStore("media").delete(b.cursor.key);return g.wpu(b)}).then(function(){return f})})}))})},YHQ=function(k,p){var t,J;
return g.Q(function(q){if(q.T==1)return g.n(q,g.lr(),2);if(q.T!=3){t=q.Y;if(!t)throw g.TE("wct");return g.n(q,g.sK(t),3)}J=q.Y;return g.n(q,g.Lz(J,["captions"],{mode:"readwrite",RO:!0},function(F){var d=[];F=F.objectStore("captions");for(var S=0;S<p.length;S++){var U=g.v7(F,p[S],k+"|"+p[S].metadata.vss_id);d.push(U)}return g.Z4.all(d)}),0)})},T5a=function(k){var p,t,J;
return g.Q(function(q){if(q.T==1)return p=IDBKeyRange.bound(k+"|",k+"~"),g.n(q,g.lr(),2);if(q.T!=3){t=q.Y;if(!t)throw g.TE("gactfv");return g.n(q,g.sK(t),3)}J=q.Y;return q.return(J.getAll("captions",p))})},rKq=function(k){return g.Q(function(p){g.D_(k,0);
return p.return(N5L(k))})},ZZq=function(k){return{context:g.uS(),
videoIds:k}},CQL=function(k){return{context:g.uS(),
playlistIds:k}},AKq=function(k){return{context:g.uS(),
offlinePlaylistSyncChecks:k}},mJK=function(){this.T=new Map},WSL=function(){V4Q||(V4Q=new mJK);
return V4Q},DJR=function(k,p){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:k},metadata:p,statusCode:void 0,csn:void 0,can:void 0}},sp9=function(k,p,t){if(!t){var J=J===void 0?!1:J;
t=k.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!t||J)t=g.Zi(16),k.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",t)}k={flowNonce:t,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:p.eventType};p.metadata&&(k.flowMetadata=p.metadata);p.statusCode!==void 0&&(k.flowEventStatus=p.statusCode);p.csn&&(k.csn=p.csn);p.can&&(k.can=p.can);g.qv("flowEvent",k,void 0)},LSA=function(k){var p,t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn,W,L,c;
return g.Q(function(P){if(P.T==1)return g.n(P,jy(k,{mode:"readonly",RO:!0},function(I){return h8(I,"playbackData").then(function(pS){var q_=pS.map(function(Yh){return Yh.transfer}).filter(function(Yh){return!!Yh}),Fe=pS.map(function(Yh){return Yh.offlineVideoPolicy}).filter(function(Yh){return!!Yh}),G=pS.filter(function(Yh){return!!Yh.key}).map(function(Yh){return g.o0(g.uo(Yh.key).entityId,"downloadStatusEntity")});
q_=h8(I,"transfer",q_);Fe=h8(I,"offlineVideoPolicy",Fe);G=h8(I,"downloadStatusEntity",G);var U0=q_.then(function(Yh){Yh=Yh.reduce(function(E0,wT){(wT==null?0:wT.offlineVideoStreams)&&E0.push.apply(E0,g.m(wT.offlineVideoStreams));return E0},[]).filter(function(E0){return!!E0});
return h8(I,"offlineVideoStreams",Yh)});
return g.Z4.all([q_,Fe,U0,G]).then(function(Yh){var E0=g.Z(Yh);Yh=E0.next().value;var wT=E0.next().value;var NQ=E0.next().value;E0=E0.next().value;return[pS,Yh,wT,NQ,E0]})})}),2);
if(P.T!=3)return p=P.Y,g.n(P,jy(k,{mode:"readonly",RO:!0},function(I){return h8(I,"mainDownloadsListEntity").then(function(pS){var q_,Fe;return(Fe=(q_=pS[0])==null?void 0:q_.downloads)!=null?Fe:[]})}),3);
t=P.Y;J=g.Z(p);q=J.next().value;F=J.next().value;d=J.next().value;S=J.next().value;U=J.next().value;f=q;b=F;N=d;y=S;Y=U;T={};A={};V={};D={};v={};w=[];X=g.Z(b);for(B=X.next();!B.done;B=X.next())(O=B.value)&&(T[O.key]=O);l=g.Z(N);for(oi=l.next();!oi.done;oi=l.next())($h=oi.value)&&(A[$h.key]=$h);kh=g.Z(Y);for(h=kh.next();!h.done;h=kh.next())(x=h.value)&&(V[x.key]=x);C=g.Z(y);for(a=C.next();!a.done;a=C.next())(zL=a.value)&&(D[zL.key]=zL);AC=g.Z(t);for(bJ=AC.next();!bJ.done;bJ=AC.next())LS=bJ.value,KS=
void 0,v[(KS=LS.videoItem)!=null?KS:""]=!0,LS.videoItem&&(Yn=JC=void 0,W=(Yn=(JC=g.uo(LS.videoItem))==null?void 0:JC.entityId)!=null?Yn:"",w.push({externalVideoId:W}));L=f.filter(function(I){if(!I||!I.key||!I.offlineVideoPolicy)return!1;I=g.uo(I.key).entityId;I=g.o0(I,"downloadStatusEntity");var pS;return!(I&&((pS=V[I])==null?void 0:pS.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
c=L.map(function(I){var pS=T[I.transfer],q_=[];if(pS==null?0:pS.offlineVideoStreams)for(var Fe=g.Z(pS.offlineVideoStreams),G=Fe.next();!G.done;G=Fe.next())(G=D[G.value])&&q_.push(G);Fe=A[I.offlineVideoPolicy];G=v;var U0=I==null?void 0:I.playerResponseTimestamp,Yh=g.uo(Fe.key).entityId;I=g.o0(Yh,"mainVideoEntity");if(Fe.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var E0="OFFLINE_VIDEO_STATE_DISABLED";Fe.expirationTimestamp&&Number(Fe.expirationTimestamp)<Date.now()/1E3&&(E0="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Fe.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")E0="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(pS==null?void 0:pS.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":E0="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":E0="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":E0="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":E0="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":E0="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":E0="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:E0="OFFLINE_VIDEO_STATE_UNKNOWN"}if(E0==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(pS==null?void 0:pS.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":E0="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":E0="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":E0=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Yh={id:Yh,videoState:E0};if(pS==null?0:pS.cotn)Yh.cotn=pS.cotn;if(pS==null?0:pS.maximumDownloadQuality)Yh.selectedVideoQuality=pS==null?void 0:pS.maximumDownloadQuality;if(pS==null?0:pS.lastProgressTimeMs)Yh.lastProgressTimeMs=pS.lastProgressTimeMs;U0&&(Yh.playerResponseSavedTimeMs=String(Number(U0)*1E3));pS=String;U0=0;q_=g.Z(q_);for(E0=q_.next();!E0.done;E0=q_.next())if(E0=E0.value,E0.streamsProgress){E0=g.Z(E0.streamsProgress);for(var wT=E0.next();!wT.done;wT=
E0.next()){var NQ=void 0;U0+=Number((NQ=wT.value.numBytesDownloaded)!=null?NQ:0)}}Yh.downloadedBytes=pS(U0);Yh.selectedOfflineMode=G[I]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Fe.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Yh.offlinePlaybackDisabledReason=Fe.offlinePlaybackDisabledReason);return Yh});
return P.return({offlineVideos:c,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:w}}})})},vc4=function(){this.locks=navigator.locks},cKS=function(){try{var k=g.hw("ytglobal.locks_");
if(k)return k;var p;if(p=navigator){var t=navigator;p="locks"in t&&!!t.locks}if(p)return g.B9.localStorage&&g.B9.localStorage.getItem("noop"),k=new vc4,g.eM("ytglobal.locks_",k),k}catch(J){}},kv=function(){},nca=function(){},wCC=function(k){if(k.includes(":"))throw Error("Invalid user cache name: "+k);
return k+":"+g.au("CacheStorage get")},iZJ=function(){return g.Q(function(k){if(pi!==void 0)return k.return(pi);
pi=new Promise(function(p){var t;return g.Q(function(J){switch(J.T){case 1:return g.Aw(J,2),g.n(J,tU.open("test-only"),4);case 4:return g.n(J,tU.delete("test-only"),5);case 5:g.Vi(J,3);break;case 2:if(t=g.W9(J),t instanceof Error&&t.name==="SecurityError")return p(!1),J.return();case 3:p("caches"in window),g.CS(J)}})});
return k.return(pi)})},PQq=function(){return g.Q(function(k){if(k.T==1)return g.n(k,iZJ(),2);
if(!k.Y)return k.return(void 0);Qp9||(Qp9=new nca);return k.return(Qp9)})},JU=function(k,p,t){g.wt(new g.hm("Woffle: "+k,t?{cotn:t}:""));
p instanceof Error&&g.wt(p)},GT4=function(k){var p;
return g.Q(function(t){if(t.T==1)return g.n(t,LSA(k),2);p=t.Y;g.qv("offlineStateSnapshot",p);g.CS(t)})},od=function(k){g.R.call(this);
var p=this;this.api=k;this.u3={OFY:function(){return p.T},
kJO:function(){return p.Y}};
typeof g.B9.BroadcastChannel!=="undefined"&&(this.T=new g.B9.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.au()),this.T.onmessage=this.N.bind(this),this.Y=new g.B9.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.au()),this.Y.onmessage=this.C.bind(this))},qt=function(k,p){k.api.zb("onOfflineOperationFailure",p);
var t;(t=k.T)==null||t.postMessage(p)},I09=function(k,p,t,J){var q=this;
this.B=k;this.L=p;this.visibility=t;this.D=J;this.X=this.Z=this.S=this.N=this.T=!1;this.C=new g.jF(function(){q.hJ()});
this.u3={eA:function(){return q.Y},
hJ:function(){q.hJ()},
U80:function(){return q.C}};
this.visibility.subscribe("visibilitystatechange",function(){q.y7()})},XC4=function(k){if(!k.N&&!k.T){var p=cKS();
if(p){k.N=!0;var t=g.au("OfflineLockManager");p.request("woffle_orchestration_leader:"+t,{},function(){var J,q,F,d;return g.Q(function(S){switch(S.T){case 1:return g.Aw(S,2),k.Y=new g.yM,k.T=!0,k.N=!1,g.n(S,k.B(),4);case 4:return g.n(S,k.Y.promise,5);case 5:g.Vi(S,0);break;case 2:J=g.W9(S),((F=(q=k).D)==null?0:F.call(q,"wo_relinquish_leadership_on_lock_request_error"))||k.hJ(),J instanceof Error&&(d=J,d.args=[{name:"WoLockManagerError",sj:J.name}],g.nV(d)),g.CS(S)}})})}}},RkW=function(k){k.T&&(k.X=
!0,Fi(k))},B54=function(k,p){k.T&&(k.S=p,Fi(k))},zk9=function(k,p){k.T&&(k.Z=p,Fi(k))},Fi=function(k){k.Z&&k.S&&k.X&&k.visibility.isBackground()?g.Oc(k.C,6E4):k.C.stop()},$v=function(k){var p;
k.offlineDeleteReason=(p=k.offlineDeleteReason)!=null?p:"OFFLINE_DELETE_REASON_UNKNOWN";var t;k.offlineModeType=(t=k.offlineModeType)!=null?t:"OFFLINE_NOW";g.qv("offlineDeleteEvent",k)},dW=function(k,p){var t=p.videoId;
var J=p.A_;p=p.offlineModeType;k.encryptedVideoId=t;k.cotn=J==null?void 0:J.cotn;k.offlineabilityFormatType=J==null?void 0:J.maximumDownloadQuality;var q;k.isRefresh=(q=J==null?void 0:J.isRefresh)!=null?q:!1;var F;k.softErrorCount=(F=J==null?void 0:J.transferRetryCount)!=null?F:0;k.offlineModeType=p!=null?p:"OFFLINE_NOW";(k.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&k.statusType==="UNKNOWN_STATUS_TYPE"||!k.transferStatusType&&!k.statusType)&&g.wt(Error("Woffle unknown transfer status"));
g.qv("offlineTransferStatusChanged",k)},ekc=function(k,p,t,J){J={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!J};p&&t&&(p=Math.floor(p/1024).toFixed(),t=Math.floor(t/1024).toFixed(),J.alreadyDownloadedKbytes=p,J.totalFetchedKbytes=p,J.totalContentKbytes=t);dW(J,k)},hkn=function(k){dW({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},k)},a0R=function(k){switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
E7=function(k){var p,t,J;
return((J=(p=k.actionMetadata)==null?void 0:(t=p.retryScheduleIntervalsInSeconds)==null?void 0:t.length)!=null?J:0)>0},SZ=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!k.entityKey},U7=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!k.entityKey},fi=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!k.entityKey},M44=function(k){return k.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!k.entityKey},
b8=function(k,p,t,J,q){q=q===void 0?!1:q;
var F,d,S,U,f,b;return g.Q(function(N){if(N.T==1)return F=g.o0(k,p),d=g.o0(k,"downloadStatusEntity"),g.n(N,jy(t,{mode:"readonly",RO:!0},function(y){return g.Z4.all([ey(y,F,p),ey(y,d,"downloadStatusEntity")])}),2);
S=N.Y;U=S.length?S[0]:void 0;if(!U)return N.oY(0);f=gcc;if(b=S.length>1?S[1]:void 0){if(b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!q)return N.return();b.downloadState=J}else b={key:d,downloadState:J};g.Il(U,f,b);return g.n(N,jy(t,{mode:"readwrite",RO:!0},function(y){return g.Z4.all([My(y,U,p),My(y,b,"downloadStatusEntity")])}),0)})},Nt=function(k,p){return k.actionType===p.actionType&&k.entityKey===p.entityKey},yW=function(k,p){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!==
"TRANSFER_STATE_FAILED"){var t=g.uo(k.key).entityId;
dW({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:t,A_:k,offlineModeType:p})}},Yv=function(k){if(!k||!k.thumbnails)return[];
var p=[];k=g.Z(k.thumbnails);for(var t=k.next();!t.done;t=k.next())t=t.value,t.url&&p.push(t.url);return p},ujJ=function(k,p,t){t=t===void 0?[]:t;
var J,q,F,d,S,U,f,b,N,y,Y,T,A;return g.Q(function(V){if(V.T==1)return t.length?g.n(V,Hq(k,p),2):V.return([]);J=V.Y;q=new Set;F=g.Z(J);for(d=F.next();!d.done;d=F.next())if(S=d.value,U=S.id||S.key)f=g.uo(U).entityId,q.add(f);b=[];N=g.Z(t);for(y=N.next();!y.done;y=N.next())Y=y.value,T=Y.offlineVideoData,A=void 0,((A=T)==null?0:A.videoId)&&!q.has(T.videoId)&&b.push(Y);return V.return(b)})},l0S=function(k,p,t){return new g.Rj(k,{cotn:p,
raw_player_response:t,download_media:!0,start:Infinity,disable_watch_next:!0})},jpC=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},TV=function(k,p,t,J,q,F,d,S,U,f,b){this.entityType=k;
this.actionId=p;this.action=t;this.parentActionId=J;this.rootActionId=q===void 0?p:q;this.childActionIds=F;this.prereqActionId=d;this.postreqActionIds=S;this.hasChildActionFailed=f;this.retryScheduleIndex=0;this.T=b||Date.now();this.retryScheduleIndex=U||0},rW=function(k){if(!k.key)throw Error("Entity key is required.");
if(!k.actionProto)throw Error("OfflineOrchestrationAction is required.");var p=g.uo(k.key),t=g.uo(k.actionProto.entityKey);return new TV(t.entityType,p.entityId,k.actionProto,k.parentActionId,k.rootActionId,k.childActionIds,k.prereqActionId,k.postreqActionIds,k.retryScheduleIndex,k.hasChildActionFailed,Number(k.enqueueTimeSec)*1E3)},Zg=function(k){return{key:g.o0(k.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:k.action,parentActionId:k.parentActionId,rootActionId:k.rootActionId,childActionIds:k.childActionIds,prereqActionId:k.prereqActionId,postreqActionIds:k.postreqActionIds,retryScheduleIndex:k.retryScheduleIndex,hasChildActionFailed:k.hasChildActionFailed,enqueueTimeSec:(k.T/1E3).toFixed()}},OZa=function(){var k;
return g.Q(function(p){return p.T==1?g.n(p,PQq(),2):(k=p.Y)?p.return(k.delete("yt-player-local-img")):p.return(!0)})},Ci=function(k){var p,t;
return g.Q(function(J){if(J.T==1)return g.n(J,PQq(),2);if(J.T!=3){p=J.Y;if(!p)throw Error("Cache API not supported");return k.length?g.n(J,p.open("yt-player-local-img"),3):J.return()}t=J.Y;return g.n(J,Promise.all(k.map(function(q){return t.delete(q)})),0)})},AU=function(k){var p,t;
return g.Q(function(J){if(J.T==1)return g.n(J,PQq(),2);if(J.T!=3){p=J.Y;if(!p)throw Error("Cache API not supported");return k.length?g.n(J,p.open("yt-player-local-img"),3):J.return()}t=J.Y;return g.n(J,t.addAll(k),0)})},md=function(k,p,t,J,q){var F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS;
return g.Q(function(JC){switch(JC.T){case 1:return F=g.o0(k,"mainVideoEntity"),d=g.o0(k,"ytMainChannelEntity"),S=g.o0(k,"transfer"),U=g.o0(k,"videoDownloadContextEntity"),g.n(JC,jy(p,{mode:"readonly",RO:!0},function(Yn){return g.Z4.all([ey(Yn,F,"mainVideoEntity"),ey(Yn,d,"ytMainChannelEntity"),ey(Yn,S,"transfer"),ey(Yn,U,"videoDownloadContextEntity"),h8(Yn,"ytMainChannelEntity"),h8(Yn,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=JC.Y;b=g.Z(f);N=b.next().value;y=b.next().value;Y=b.next().value;T=b.next().value;A=b.next().value;V=b.next().value;D=N;v=y;w=Y;X=T;B=A;O=V;if(!D&&!v){JC.oY(3);break}l=D?Yv(D.thumbnail):[];if(!v){oi=[];JC.oY(4);break}return g.n(JC,KSA(v,B),5);case 5:oi=JC.Y;case 4:return $h=oi,g.n(JC,Ci(l.concat($h)),3);case 3:kh=[];h=g.o0(k,"downloadStatusEntity");x=g.Z(O);for(C=x.next();!C.done;C=x.next())a=C.value,zL=g.uo(a.key).entityId,AC=rW(a),bJ=g.uo(AC.action.entityKey).entityId,zL!==k&&bJ!==k||Nt(t,
a.actionProto)||kh.push(a.key);return g.n(JC,jy(p,{mode:"readwrite",RO:!0},function(Yn){var W=kh.map(function(L){return gf(Yn,L)});
W.push(gf(Yn,F,{j0:!0}));W.push(gf(Yn,h,{j0:!0}));return g.Z4.all(W)}),7);
case 7:KS=(LS=X)==null?void 0:LS.offlineModeType,q&&($v(q),q.offlineModeType&&(KS=q.offlineModeType)),yW(w,KS),qt(J,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.CS(JC)}})},kfR=function(k,p,t,J){var q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn,W,L,c,P,I,pS,q_,Fe,G,U0,Yh,E0,wT,NQ,RL,bP;
return g.Q(function(M_){switch(M_.T){case 1:return q=g.o0(k,"mainPlaylistEntity"),F=g.o0(k,"ytMainChannelEntity"),g.n(M_,jy(p,{mode:"readonly",RO:!0},function(B4){return g.Z4.all([ey(B4,q,"mainPlaylistEntity"),ey(B4,F,"ytMainChannelEntity"),h8(B4,"mainPlaylistEntity"),h8(B4,"mainDownloadsListEntity"),h8(B4,"ytMainChannelEntity"),h8(B4,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=M_.Y;S=g.Z(d);U=S.next().value;f=S.next().value;b=S.next().value;N=S.next().value;y=S.next().value;Y=S.next().value;T=U;A=f;V=b;D=N;v=y;w=Y;if(!T&&!A){M_.oY(3);break}X=T?HZS(T):[];if(!A){B=[];M_.oY(4);break}return g.n(M_,KSA(A,v),5);case 5:B=M_.Y;case 4:return O=B,g.n(M_,Ci(X.concat(O)),3);case 3:l=[];oi=new Map;if(!T){M_.oY(7);break}return g.n(M_,xJK(T,V,D),8);case 8:l=M_.Y;$h=g.Z(l);for(kh=$h.next();!kh.done;kh=$h.next())h=kh.value,oi.set(h,{videoId:h,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.n(M_,jy(p,{mode:"readonly",RO:!0},function(B4){return g.Z4.all([h8(B4,"transfer"),h8(B4,"videoDownloadContextEntity")])}),9);
case 9:x=M_.Y;C=g.Z(x);a=C.next().value;zL=C.next().value;AC=a;bJ=zL;LS=g.Z(AC);for(KS=LS.next();!KS.done;KS=LS.next())JC=KS.value,Yn=g.uo(JC.key).entityId,(W=oi.get(Yn))&&JC&&(W.cotn=JC.cotn);L=g.Z(bJ);for(c=L.next();!c.done;c=L.next())P=c.value,I=g.uo(P.key).entityId,(pS=oi.get(I))&&P&&(pS.offlineModeType=P.offlineModeType);case 7:q_=[];Fe=g.Z(w);for(G=Fe.next();!G.done;G=Fe.next())U0=G.value,Yh=g.uo(U0.key).entityId,E0=rW(U0),Yh!==k&&E0.rootActionId!==k||Nt(t,U0.actionProto)||q_.push(U0.key);wT=
g.o0(k,"mainPlaylistEntity");return g.n(M_,jy(p,{mode:"readwrite",RO:!0},function(B4){var Eb=q_.map(function(wx){return gf(B4,wx)});
Eb.push(gf(B4,wT,{j0:!0}));return g.Z4.all(Eb)}),10);
case 10:if(!T){M_.oY(0);break}l.reverse();if(!l){M_.oY(0);break}NQ=g.Z(l);RL=NQ.next();case 13:if(RL.done){M_.oY(0);break}bP=RL.value;return g.n(M_,md(bP,p,t,J,oi.get(bP)),14);case 14:RL=NQ.next(),M_.oY(13)}})},tLJ=function(k,p,t,J){var q,F,d,S,U,f,b,N,y;
return g.Q(function(Y){if(Y.T==1)return q=g.o0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),F=new Map,g.n(Y,jy(k,{mode:"readwrite",RO:!0},function(T){var A=h8(T,"transfer"),V=h8(T,"offlineOrchestrationActionWrapperEntity"),D=h8(T,"videoDownloadContextEntity"),v=ey(T,q,"mainDownloadsListEntity");return g.Z4.all([A,V,D,v]).then(function(w){w=g.Z(w);var X=w.next().value;var B=w.next().value;var O=w.next().value;var l=w.next().value;w=pUa.map(function($h){return HOq(T,$h)});
B=g.Z(B);for(var oi=B.next();!oi.done;oi=B.next())oi=oi.value,Nt(p,oi.actionProto)||w.push(gf(T,oi.key,{j0:!0}));l&&(l.downloads=[],w.push(My(T,l,"mainDownloadsListEntity")));if(O)for(O=g.Z(O),l=O.next();!l.done;l=O.next())l=l.value,B=g.uo(l.key).entityId,B=g.o0(B,"transfer"),F.set(B,l.offlineModeType);return g.Z4.all(w).then(function(){return X})})}),2);
d=Y.Y;S=g.Z(d);for(U=S.next();!U.done;U=S.next())f=U.value,yW(f,F.get(f.key)),b=g.uo(f.key).entityId,N={videoId:b,offlineDeleteReason:J,cotn:f.cotn,offlineModeType:F.get(f.key)},$v(N),y=g.o0(b,"mainVideoEntity"),qt(t,{entityKey:y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.n(Y,OZa(),0)})},HZS=function(k,p){var t=[];
if(k.thumbnailStyleData){k=g.Z(k.thumbnailStyleData);for(var J=k.next();!J.done;J=k.next()){var q=void 0,F=void 0,d=void 0;t=t.concat(Yv((q=J.value)==null?void 0:(F=q.value)==null?void 0:(d=F.collageThumbnail)==null?void 0:d.coverThumbnail))}}p=Yv(p);return t.concat(p)},xJK=function(k,p,t){var J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h;
return g.Q(function(kh){J=[];q=new Set;if(t.length)for(F=g.Z(t),d=F.next();!d.done;d=F.next())if(S=d.value,U=void 0,(U=S.downloads)==null?0:U.length)for(f=g.Z(S.downloads),b=f.next();!b.done;b=f.next())N=b.value,N.videoItem&&(y=g.uo(N.videoItem).entityId,q.add(y));if(k.videos){Y=g.Z(k.videos);for(T=Y.next();!T.done;T=Y.next())A=T.value,V=JSON.parse(g.uo(A).entityId),V.videoId&&!q.has(V.videoId)&&J.push(V.videoId);D=g.Z(p);for(v=D.next();!v.done;v=D.next())if(w=v.value,w.key!==k.key&&(X=w.videos))for(B=
g.Z(X),O=B.next();!O.done;O=B.next())l=O.value,oi=JSON.parse(g.uo(l).entityId),oi.videoId&&($h=J.indexOf(oi.videoId),$h!==-1&&J.splice($h,1))}return kh.return(J)})},KSA=function(k,p){var t,J,q,F,d,S,U,f;
return g.Q(function(b){t=Yv(k.avatar);J=g.Z(p);for(q=J.next();!q.done;q=J.next())if(F=q.value,F.id!==k.id)for(d=g.Z(Yv(F.avatar)),S=d.next();!S.done;S=d.next())U=S.value,f=t.indexOf(U),f!==-1&&t.splice(f,1);return b.return(t)})},JfK=function(k){var p;
return g.Q(function(t){p=g.e(k.frameworkUpdates,VW);return k.frameworkUpdates&&p?g.n(t,UJQ(p),0):t.return()})},qUJ=function(k){var p;
if((p=k.onResponseReceivedActions)!=null&&p.length){var t;k=(t=g.e(g.e(k.onResponseReceivedActions[0],o8J),g.VDS))==null?void 0:t.actions;if(k!=null&&k.length)return k}},FyS=function(k){var p,t,J;
return g.Q(function(q){if(q.T==1)return k?g.n(q,K3(k,g.Py,"mainDownloadsListEntity"),2):q.return([]);p=q.Y;return((t=p)==null?0:(J=t.downloads)==null?0:J.length)?q.return(p.downloads.map(function(F){var d;return(d=F.videoItem)!=null?d:""})):q.return([])})},dRa=function(k,p){var t;
return g.Q(function(J){return J.T==1?g.n(J,$RC(k,p),2):(t=J.Y)?g.n(J,jy(k,{mode:"readwrite",RO:!0},function(q){var F=[My(q,t.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];t.mainDownloadsListEntity&&F.push(My(q,t.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Z4.all(F)}),0):J.oY(0)})},$RC=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w;
return g.Q(function(X){if(X.T==1)return t=g.o0("main_downloads_library_id","mainDownloadsLibraryEntity"),J=g.o0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.n(X,jy(k,{mode:"readonly",RO:!0},function(B){return g.Z4.all([ey(B,t,"mainDownloadsLibraryEntity"),ey(B,J,"mainDownloadsListEntity")])}),2);
q=X.Y;F=g.Z(q);d=F.next().value;S=F.next().value;U=d;f=S;U||(U={id:t});b=g.Z(p);for(N=b.next();!N.done;N=b.next())if(y=N.value,y===g.Py){if(U.smartDownloadsList)return X.return();U.smartDownloadsList=y}else if(Y=g.uo(y).entityType,T={},Y==="mainPlaylistEntity"?T.playlistItem=y:Y==="mainVideoEntity"&&(T.videoItem=y),!g.cQ(T)){A=void 0;if((A=f)==null?0:A.downloads){V=!1;D=g.Z(f.downloads);for(v=D.next();!v.done;v=D.next())if(w=v.value,w.playlistItem===y||w.videoItem===y){V=!0;break}V||f.downloads.push(T)}else f=
{id:J,downloads:[T]};U.downloadsList=J}return X.return({mainDownloadsLibraryEntity:U,mainDownloadsListEntity:f})})},E8K=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V;
return g.Q(function(D){if(D.T==1)return t=g.o0("main_downloads_library_id","mainDownloadsLibraryEntity"),J=g.o0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.n(D,jy(k,{mode:"readonly",RO:!0},function(v){return g.Z4.all([ey(v,t,"mainDownloadsLibraryEntity"),ey(v,J,"mainDownloadsListEntity"),ey(v,g.Py,"mainDownloadsListEntity")])}),2);
q=D.Y;F=g.Z(q);d=F.next().value;S=F.next().value;U=F.next().value;f=d;b=S;N=U;if(!f)return D.oY(0);if(p===g.Py&&((y=N)==null?0:y.downloads))N.downloads=[];else if((Y=b)==null?0:Y.downloads)for(T=g.uo(p).entityType,A=0;A<b.downloads.length;A++)if(V=b.downloads[A],T==="mainVideoEntity"&&V.videoItem===p){b.downloads.splice(A,1);break}else if(T==="mainPlaylistEntity"&&V.playlistItem===p){b.downloads.splice(A,1);break}return g.n(D,jy(k,{mode:"readwrite",RO:!0},function(v){var w=[My(v,f,"mainDownloadsLibraryEntity")];
b&&w.push(My(v,b,"mainDownloadsListEntity"));N&&w.push(My(v,N,"mainDownloadsListEntity"));return g.Z4.all(w)}),0)})},WN=function(k,p){var t,J,q,F,d,S,U,f,b,N,y;
return g.Q(function(Y){if(Y.T==1)return t=g.o0(p,"transfer"),J=g.o0(p,"videoDownloadContextEntity"),g.n(Y,jy(k,{mode:"readonly",RO:!0},function(T){return g.Z4.all([ey(T,t,"transfer"),ey(T,J,"videoDownloadContextEntity")])}),2);
q=Y.Y;F=g.Z(q);d=F.next().value;S=F.next().value;U=d;f=S;y={videoId:p,cotn:(b=U)==null?void 0:b.cotn,offlineModeType:(N=f)==null?void 0:N.offlineModeType};return Y.return(y)})},Dg=function(k,p,t,J,q){var F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi;
return g.Q(function($h){switch($h.T){case 1:return F=g.o0(k,"musicTrack"),d=g.o0(k,"transfer"),g.n($h,jy(p,{mode:"readonly",RO:!0},function(kh){return g.Z4.all([ey(kh,F,"musicTrack"),ey(kh,d,"transfer"),h8(kh,"musicTrack"),h8(kh,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=$h.Y;U=g.Z(S);f=U.next().value;b=U.next().value;N=U.next().value;y=U.next().value;Y=f;T=b;A=N;V=y;if(!Y){$h.oY(3);break}return g.n($h,SUL(Y,A),4);case 4:return D=$h.Y,g.n($h,Ci(D),3);case 3:v=[];w=g.Z(V);for(X=w.next();!X.done;X=w.next())B=X.value,O=g.uo(B.key).entityId,l=rW(B),oi=g.uo(l.action.entityKey).entityId,O!==k&&oi!==k||Nt(t,B.actionProto)||v.push(B.key);return g.n($h,jy(p,{mode:"readwrite",RO:!0},function(kh){var h=v.map(function(x){return gf(kh,x)});
h.push(gf(kh,F,{j0:!0}));return g.Z4.all(h)}),6);
case 6:yW(T),q&&$v(q),qt(J,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.CS($h)}})},s7=function(k,p,t,J,q){var F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn,W,L,c;
return g.Q(function(P){switch(P.T){case 1:return F=g.o0(k,p),d=g.o0("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(P,jy(t,{mode:"readonly",RO:!0},function(I){return g.Z4.all([ey(I,F,p),ey(I,d,"musicDownloadsLibraryEntity"),h8(I,p),h8(I,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=P.Y;U=g.Z(S);f=U.next().value;b=U.next().value;N=U.next().value;y=U.next().value;Y=f;T=b;A=N;V=y;if(!Y){P.oY(3);break}return g.n(P,SUL(Y,A),4);case 4:return D=P.Y,g.n(P,Ci(D),3);case 3:v=[];w=new Map;if(!Y){P.oY(6);break}return g.n(P,URW(Y,A,T),7);case 7:v=P.Y;X=g.Z(v);for(B=X.next();!B.done;B=X.next())O=B.value,l=g.uo(O).entityId,w.set(l,{videoId:l,playlistId:k,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.n(P,Hq(t,"transfer"),8);case 8:for(oi=P.Y,$h=g.Z(oi),
kh=$h.next();!kh.done;kh=$h.next())h=kh.value,x=g.uo(h.key).entityId,(C=w.get(x))&&h&&(C.cotn=h.cotn);case 6:a=[];zL=g.Z(V);for(AC=zL.next();!AC.done;AC=zL.next())bJ=AC.value,LS=g.uo(bJ.key).entityId,KS=rW(bJ),LS!==k&&KS.rootActionId!==k||Nt(J,bJ.actionProto)||a.push(bJ.key);JC=g.o0(k,p);return g.n(P,jy(t,{mode:"readwrite",RO:!0},function(I){var pS=a.map(function(q_){return gf(I,q_)});
pS.push(gf(I,JC,{j0:!0}));return g.Z4.all(pS)}),9);
case 9:if(!Y){P.oY(0);break}v.reverse();if(!v.length){P.oY(0);break}Yn=g.Z(v);W=Yn.next();case 12:if(W.done){P.oY(0);break}L=W.value;c=g.uo(L).entityId;if(!c){P.oY(13);break}return g.n(P,Dg(c,t,J,q,w.get(c)),13);case 13:W=Yn.next(),P.oY(12)}})},Li=function(k,p,t){var J,q,F,d,S,U,f;
return g.Q(function(b){if(b.T==1)return g.n(b,jy(k,{mode:"readwrite",RO:!0},function(N){var y=h8(N,"transfer"),Y=h8(N,"offlineOrchestrationActionWrapperEntity");return g.Z4.all([y,Y]).then(function(T){T=g.Z(T);var A=T.next().value;var V=T.next().value;T=fHK.map(function(X){return HOq(N,X)});
V=g.Z(V);for(var D=V.next();!D.done;D=V.next()){D=D.value;var v=g.uo(D.actionProto.entityKey).entityType==="musicTrack",w=D.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";Nt(p,D.actionProto)||v&&(!v||w)||T.push(gf(N,D.key,{j0:!0}))}return g.Z4.all(T).then(function(){return A})})}),2);
J=b.Y;q=g.Z(J);for(F=q.next();!F.done;F=q.next())d=F.value,yW(d),S=g.uo(d.key).entityId,U={videoId:S,offlineDeleteReason:void 0,cotn:d.cotn},$v(U),f=g.o0(S,"musicTrack"),qt(t,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.n(b,OZa(),0)})},b6W=function(k){for(var p,t=g.Z(k.additionalMetadatas),J=t.next();!J.done;J=t.next())J=J.value,J.offlineMusicVideoData&&(p=J.offlineMusicVideoData);
var q,F,d,S,U;return{id:g.o0(k.videoId,"musicTrack"),videoId:k.videoId,title:k.title,thumbnailDetails:k.thumbnail,lengthMs:String(Number(k.lengthSeconds)*1E3),albumTitle:(q=p)==null?void 0:q.releaseTitle,musicVideoType:(F=p)==null?void 0:F.musicVideoType,contentRating:{explicitType:(d=p)==null?void 0:d.explicitType},artistNames:((S=p)==null?void 0:S.byline)||((U=p)==null?void 0:U.channelName),downloadMetadata:g.o0(k.videoId,"musicTrackDownloadMetadataEntity")}},URW=function(k,p,t){var J,q,F,d,S,U,
f,b,N,y,Y,T,A,V,D,v,w,X;
return g.Q(function(B){J=[];q=new Set;if((F=t)==null?0:(d=F.downloadedTracks)==null?0:d.length)for(S=g.Z(t.downloadedTracks),U=S.next();!U.done;U=S.next())f=U.value,q.add(f);if(k.tracks){b=g.Z(k.tracks);for(N=b.next();!N.done;N=b.next())y=N.value,q.has(y)||J.push(y);Y=g.Z(p);for(T=Y.next();!T.done;T=Y.next())if(A=T.value,A.id!==k.id&&(V=A.tracks))for(D=g.Z(V),v=D.next();!v.done;v=D.next())w=v.value,X=J.indexOf(w),X!==-1&&J.splice(X,1)}return B.return(J)})},SUL=function(k,p){var t,J,q,F,d,S,U,f;
return g.Q(function(b){t=Yv(k.thumbnailDetails);J=g.Z(p);for(q=J.next();!q.done;q=J.next())if(F=q.value,F.id!==k.id)for(d=g.Z(Yv(F.thumbnailDetails)),S=d.next();!S.done;S=d.next())U=S.value,f=t.indexOf(U),f!==-1&&t.splice(f,1);return b.return(t)})},NZC=function(k,p){var t,J,q,F,d,S,U,f,b;
return g.Q(function(N){if(N.T==1)return t=g.o0("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(N,K3(k,t,"musicDownloadsLibraryEntity"),2);(J=N.Y)||(J={id:t});q=g.uo(p).entityType;q==="musicTrack"?(F=J.downloadedTracks)!=null&&F.includes(p)||(J.downloadedTracks=((d=J.downloadedTracks)!=null?d:[]).concat(p)):q==="musicPlaylist"?(S=J.downloadedPlaylists)!=null&&S.includes(p)||(J.downloadedPlaylists=((U=J.downloadedPlaylists)!=null?U:[]).concat(p)):q!=="musicAlbumRelease"||(f=J.downloadedAlbumReleases)!=
null&&f.includes(p)||(J.downloadedAlbumReleases=((b=J.downloadedAlbumReleases)!=null?b:[]).concat(p));return g.n(N,Oz(k,J,"musicDownloadsLibraryEntity"),0)})},yfc=function(k,p){var t,J,q,F,d,S,U;
return g.Q(function(f){if(f.T==1)return t=g.o0("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(f,K3(k,t,"musicDownloadsLibraryEntity"),2);J=f.Y;if(!J)return f.oY(0);q=g.uo(p).entityType;q==="musicTrack"?F=J.downloadedTracks:q==="musicPlaylist"&&(F=J.downloadedPlaylists);if((d=F)==null?0:d.length)for(S=0;S<F.length;S++)if(U=F[S],U===p){F.splice(S,1);break}return g.n(f,Oz(k,J,"musicDownloadsLibraryEntity"),0)})},YUa=function(k){var p=k.videos;
k=[];var t=[];if(p){p=g.Z(p);for(var J=p.next();!J.done;J=p.next()){var q=J.value.offlineVideoData.videoId;J=g.o0(q,"musicTrack");q=g.o0(q,"musicTrackDownloadMetadataEntity");k.push(J);t.push(q)}}return{aF:k,Bx:t}},vN=function(k,p,t){p={track:b6W(p)};
t&&(p.playlistId=t);if(k=g.e(k.actionMetadata,TZa))p.maximumDownloadQuality=k.maximumDownloadQuality;return{musicTrackEntityActionMetadata:p}},Z6a=function(k){var p,t,J,q,F,d,S,U;
return g.Q(function(f){switch(f.T){case 1:return p=g.tc(),t=ZZq(k),J=g.Oy(rfJ),g.Aw(f,2),F={GJ:!0},g.n(f,g.MT(p,t,J,void 0,F),4);case 4:q=f.Y;g.Vi(f,3);break;case 2:d=g.W9(f);if(d instanceof g.eR)throw S="GetOffline network manager error: "+d.message,JU(S,d),Error(S);JU("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:U=cN(q);if(!q)throw JU("Network request failed"),Error("Network request failed");if(U!==void 0)ni(U);else if(!q.videos||!q.videos.length)throw JU("No data"),
Error("No data");return f.return(q.videos.map(function(b){return b.offlineVideoData}))}})},CDq=function(k){var p,t,J,q,F,d,S,U;
return g.Q(function(f){switch(f.T){case 1:return p=g.tc(),t=CQL(k),J=g.Oy(rfJ),g.Aw(f,2),F={GJ:!0},g.n(f,g.MT(p,t,J,void 0,F),4);case 4:q=f.Y;g.Vi(f,3);break;case 2:d=g.W9(f);if(d instanceof g.eR)throw S="GetOffline network manager error for playlist: "+d.message,JU(S,d),Error(S);JU("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:U=cN(q);if(!q)throw JU("Network request failed for playlist"),Error("Network request failed for playlist");
if(U!==void 0)ni(U,"playlist");else if(!q.playlists||!q.playlists.length)throw JU("No data for playlist"),Error("No data for playlist");return f.return(q.playlists.map(function(b){return b.offlinePlaylistData}))}})},mRq=function(k,p,t,J){var q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ;
return g.Q(function(LS){switch(LS.T){case 1:return g.n(LS,xV(),2);case 2:q=LS.Y;if(!q)return LS.return([]);F=[];if((d=J)==null?0:d.length){F=J;LS.oY(3);break}return g.n(LS,Hq(q,"mainPlaylistEntity"),4);case 4:F=LS.Y;case 3:if(!F.length)return LS.return([]);S=[];U=Date.now()/1E3;f=g.Z(F);b=f.next();case 5:if(b.done)return S.length?g.n(LS,Af4(S),10):LS.return([]);N=b.value;if(!N.downloadState){y=void 0;LS.oY(8);break}return g.n(LS,K3(q,N.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:y=
LS.Y;case 8:Y=y;T=void 0;V=(A=(T=N)==null?void 0:T.entityMetadata)&&A.nextAutoRefreshIntervalSeconds?Number(A.nextAutoRefreshIntervalSeconds):NaN;D=Number.isNaN(V)?k:V;w=v=void 0;X=((v=Y)==null?0:v.lastSyncedTimestampMillis)?Number((w=Y)==null?void 0:w.lastSyncedTimestampMillis)/1E3:0;O=B=void 0;l=((B=Y)==null?0:B.addedTimestampMillis)?Number((O=Y)==null?void 0:O.addedTimestampMillis)/1E3:0;if(t||!A||X+D<=U){oi=[];$h=void 0;if(($h=N.videos)==null?0:$h.length)for(kh=g.Z(N.videos),h=kh.next();!h.done;h=
kh.next())x=h.value,C=JSON.parse(g.uo(x).entityId),C.videoId&&oi.push(C.videoId);a="0";A&&(zL=void 0,a=String(Number((zL=A.offlineLastModifiedTimestampSeconds)!=null?zL:0).toFixed()));AC={playlistId:N.playlistId,videoIds:oi,offlineLastModifiedTimestamp:a,autoSync:p,offlineDateAddedTimestamp:String(l.toFixed())};S.push(AC)}b=f.next();LS.oY(5);break;case 10:return bJ=LS.Y,LS.return(bJ)}})},VLS=function(){var k,p,t,J,q;
return g.Q(function(F){if(F.T==1)return g.n(F,xV(),2);if(F.T!=3)return(k=F.Y)?g.n(F,Hq(k,"refresh"),3):F.return(!1);p=F.Y;if((t=p[0])==null||!t.refreshTime)return F.return(!1);J=Number(p[0].refreshTime);q=Date.now()/1E3;return F.return(isFinite(J)&&q>=J)})},DRW=function(k,p){var t,J,q;
return g.Q(function(F){switch(F.T){case 1:return g.Aw(F,2),g.n(F,Wya(k,p),4);case 4:return J=F.Y,g.n(F,JfK(J),5);case 5:t=qUJ(J);g.Vi(F,3);break;case 2:q=g.W9(F),JU("getAndProcessSmartDownloadsResponse request or processing error",q);case 3:return F.return(t)}})},sQS=function(k,p,t,J){var q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ;
return g.Q(function(LS){switch(LS.T){case 1:return g.n(LS,xV(),2);case 2:q=LS.Y;if(!q)return LS.return([]);F=[];if((d=J)==null?0:d.length){F=J;LS.oY(3);break}return g.n(LS,Hq(q,"musicPlaylist"),4);case 4:F=LS.Y;case 3:if(!F.length)return LS.return([]);S=[];U=Date.now()/1E3;f=g.Z(F);b=f.next();case 5:if(b.done)return S.length?g.n(LS,Af4(S),10):LS.return([]);N=b.value;y=void 0;T=(Y=(y=N)==null?void 0:y.entityMetadata)&&Y.nextAutoRefreshIntervalSeconds?Number(Y.nextAutoRefreshIntervalSeconds):NaN;A=
Number.isNaN(T)?k:T;D=V=0;v="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!N.downloadMetadata){LS.oY(8);break}return g.n(LS,K3(q,N.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:w=LS.Y,B=X=void 0,V=Number((B=(X=w)==null?void 0:X.addedTimestampMillis)!=null?B:"0")/1E3,l=O=void 0,D=Number((l=(O=w)==null?void 0:O.lastModifiedTimestampMillis)!=null?l:"0")/1E3,$h=oi=void 0,v=($h=(oi=w)==null?void 0:oi.syncState)!=null?$h:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:kh=void 0;if(t||v!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!Y||Number((kh=Y.lastSyncedTimestampSeconds)!=null?kh:0)+A<=U){h=[];x=void 0;if((x=N.tracks)==null?0:x.length)for(C=g.Z(N.tracks),a=C.next();!a.done;a=C.next())zL=a.value,h.push(g.uo(zL).entityId);AC={playlistId:N.playlistId,videoIds:h,offlineLastModifiedTimestamp:String(D.toFixed()),autoSync:p,offlineDateAddedTimestamp:String(V.toFixed())};S.push(AC)}b=f.next();LS.oY(5);break;case 10:return bJ=LS.Y,LS.return(bJ)}})},Wya=function(k,p){var t,J,q,F,d,S,U,f,b,N;
return g.Q(function(y){switch(y.T){case 1:return t=g.tc(),g.n(y,xV(),2);case 2:J=y.Y;if(!J){y.oY(3);break}return g.n(y,LSA(J),4);case 4:q=y.Y;case 3:var Y=q;F={context:g.uS(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:k},offlineClientState:Y,clientStateRequestData:{preferredFormatType:p}}}};d=g.Oy(LyC);g.Aw(y,5);U={GJ:!0};return g.n(y,g.MT(t,F,d,void 0,U),7);case 7:S=y.Y;g.Vi(y,6);break;case 5:f=g.W9(y);if(f instanceof g.eR)throw b=
"DPS network manager error for smart downloads: "+f.message,JU(b,f),Error(b);JU("DPS fetch request error for smart downloads",f);throw Error("DPS fetch request error for smart downloads");case 6:N=cN(S);if(S)N!==void 0&&ni(N,"smart downloads");else throw JU("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return y.return(S)}})},cfL=function(k,p){var t,J,q,F,d,S,U,f;
return g.Q(function(b){switch(b.T){case 1:return t=g.tc(),J={context:g.uS(),videoPlaybackPositionEntities:k,lastSyncTimestampUsec:p},q=g.Oy(v8W),g.Aw(b,2),d={GJ:!0},g.n(b,g.MT(t,J,q,void 0,d),4);case 4:F=b.Y;g.Vi(b,3);break;case 2:S=g.W9(b);if(S instanceof g.eR)throw U="VPPS network manager error: "+S.message,JU(U,S),Error(U);JU("VPPS fetch request error",S);throw Error("VPPS fetch request error");case 3:f=cN(F);if(F)f!==void 0&&ni(f,"position sync");else throw JU("Network request failed for position sync"),
Error("Network request failed for position sync");return b.return(F)}})},wUS=function(k,p,t){var J,q,F,d,S,U,f,b;
return g.Q(function(N){switch(N.T){case 1:J=g.tc();var y=t.refreshData,Y=t.isEnqueuedForExpiredStreamUrlRefetch,T=t.OV,A=t.offlineSourceData,V=t.mediaCapabilities,D={entityKey:k};y&&(D.refreshData=y);Y&&(D.isExpiredStreamUrlRefetch=Y);T&&(D.downloadParameters=T);A&&(D.offlineSourceData=A);y={context:g.kR(p),signatureTimestamp:20145,videos:[D]};V&&(y.mediaCapabilities=V);q=y;F=g.Oy(n8n);g.Aw(N,2);S={GJ:!0};return g.n(N,g.MT(J,q,F,void 0,S),4);case 4:d=N.Y;g.Vi(N,3);break;case 2:U=g.W9(N);if(U instanceof
g.eR)throw f="GetPDE network manager error: "+U.message,JU(f,U),Error(f);JU("GetPDE fetch request error",U);throw Error("GetPDE fetch request error");case 3:b=cN(d);if(d)b!==void 0&&ni(b,"PDE");else throw JU("Network request failed for PDE"),Error("Network request failed for PDE");return N.return(d)}})},cN=function(k){var p;
return(p=k.errorMetadata)==null?void 0:p.status},ni=function(k,p){p=p?" for "+p:"";
if(k===0)throw k="Empty response body"+p,JU(k),Error(k);k="Response with error"+p;JU(k);throw Error(k);},Af4=function(k){var p,t,J,q,F,d,S,U;
return g.Q(function(f){switch(f.T){case 1:return p=g.tc(),t=AKq(k),J=g.Oy(i6S),g.Aw(f,2),F={GJ:!0},g.n(f,g.MT(p,t,J,void 0,F),4);case 4:q=f.Y;g.Vi(f,3);break;case 2:d=g.W9(f);if(d instanceof g.eR)throw S="offlinePlaylistSyncCheck network manager error: "+d.message,JU(S,d),Error(S);JU("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:U=cN(q);if(!q)throw JU("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(U!==void 0)ni(U,"playlist sync");else if(!q.offlinePlaylistSyncCheckDatas||!q.offlinePlaylistSyncCheckDatas.length)throw JU("No data for playlist sync"),Error("No data for playlist sync");return f.return(q.offlinePlaylistSyncCheckDatas.map(function(b){return b.offlinePlaylistSyncCheckData}))}})},wW=function(k){this.T=k},QQC=function(k,p){var t,J,q,F,d,S;
return g.Q(function(U){switch(U.T){case 1:t=new Map,J=g.Z(p),q=J.next();case 2:if(q.done){U.oY(4);break}F=q.value;d=t;S=d.set;return g.n(U,k.Y(F),5);case 5:S.call(d,F,U.Y);q=J.next();U.oY(2);break;case 4:return U.return(t)}})},i8=function(k,p,t,J,q,F){p=g.o0(p,t);
J=Object.assign({},F,{priority:J,retryScheduleIntervalsInSeconds:q});return{actionType:k,entityKey:p,actionMetadata:J}},QW=function(k,p,t,J,q,F){this.status=k;
this.T=p;this.C=t;this.Y=J;this.N=q;this.downloadState=F},PDQ=function(k,p,t){this.T=k;
this.ih=p;this.N=t},XU4=function(k,p){var t,J,q,F,d,S,U,f,b;
return g.Q(function(N){switch(N.T){case 1:return t=p.entityKey,q=(J=g.e(p.actionMetadata,PN))==null?void 0:J.isEnqueuedForExpiredStreamUrlRefetch,g.Aw(N,2),F=void 0,g.n(N,Gf9(k,p),4);case 4:F=N.Y;g.Aw(N,5);var y=(y=g.e(p.actionMetadata,PN))?{maximumDownloadQuality:y.maximumDownloadQuality}:void 0;return g.n(N,wUS(t,k.ih,{isEnqueuedForExpiredStreamUrlRefetch:q,OV:y,offlineSourceData:F}),7);case 7:d=N.Y;g.Vi(N,6,2);break;case 5:return g.W9(N,2),S=E7(p)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",JU("PDE handleAdd error"),N.return(GV(p,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",S,"DOWNLOAD_STATE_FAILED"));case 6:return g.n(N,IHC(k,d,p),8);case 8:return N.return(GV(p,!0,d.orchestrationActions));case 2:return U=g.W9(N),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.fz&&U.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),JU("PDE handleAdd error"),N.return(GV(p,!1,void 0,f,b,"DOWNLOAD_STATE_FAILED"))}})},z8n=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h;
return g.Q(function(kh){switch(kh.T){case 1:return t=p.entityKey,J=g.uo(t).entityId,g.n(kh,jy(k.T,{mode:"readonly",RO:!0},function(h){var x=ey(h,t,"playbackData"),C=ey(h,g.o0(J,"offlineVideoPolicy"),"offlineVideoPolicy");h=ey(h,g.o0(J,"transfer"),"transfer");return g.Z4.all([x,C,h])}),2);
case 2:q=kh.Y;F=g.Z(q);d=F.next().value;S=F.next().value;U=F.next().value;f=d;b=S;N=U;if(!f||!b)return kh.return(GV(p,!0));y=[];A=((T=f)==null?0:T.playerResponseJson)?JSON.parse(f.playerResponseJson):null;if(!(N&&A&&k.ih.D("html5_refresh_deprecated_downloads"))){kh.oY(3);break}Y=R8L(k,A,N);return g.n(kh,BZS(k,N),4);case 4:y=kh.Y;case 3:V={lastPlayerResponseTimestampSeconds:f.playerResponseTimestamp,offlineToken:b.offlineToken,formatIds:y};D={};if((v=N)==null?0:v.maximumDownloadQuality)D.maximumDownloadQuality=
N.maximumDownloadQuality;g.Aw(kh,5);w=void 0;return g.n(kh,Gf9(k,p),7);case 7:return w=kh.Y,g.Aw(kh,8),g.n(kh,wUS(t,k.ih,{refreshData:V,OV:D,offlineSourceData:w,mediaCapabilities:Y}),10);case 10:X=kh.Y;g.Vi(kh,9,5);break;case 8:return g.W9(kh,5),B=E7(p)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",JU("PDE handleRefresh error"),kh.return(GV(p,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,
"DOWNLOAD_STATE_FAILED"));case 9:return g.n(kh,IHC(k,X,p),11);case 11:return kh.return(GV(p,!0,X.orchestrationActions));case 5:return O=g.W9(kh),l="PDE handleRefresh error",O instanceof Error&&(l="PDE handleRefresh error: "+O.message),oi="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.fz&&O.type==="QUOTA_EXCEEDED"&&(oi="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
JU(l),kh.return(GV(p,!1,void 0,oi,$h,"DOWNLOAD_STATE_FAILED"))}})},Gf9=function(k,p){var t,J,q,F;
return g.Q(function(d){if(d.T==1)return t=g.uo(p.entityKey).entityId,J=g.o0(t,"videoDownloadContextEntity"),g.n(d,K3(k.T,J,"videoDownloadContextEntity"),2);q=d.Y;return(F=q)!=null&&F.offlineModeType?d.return({offlineModeType:q.offlineModeType}):d.return(void 0)})},IHC=function(k,p,t){var J,q,F,d,S;
return g.Q(function(U){if(U.T==1){if(!p.frameworkUpdates||!g.e(p.frameworkUpdates,VW))return U.return();if(!(g.e(p.frameworkUpdates,VW).mutations&&g.e(p.frameworkUpdates,VW).mutations.length>0&&g.e(p.frameworkUpdates,VW).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return U.oY(2);J=g.uo(g.e(p.frameworkUpdates,VW).mutations[0].entityKey).entityId;return g.n(U,WN(k.T,J),3)}if(U.T!=2){q=U.Y;F=g.e(t.actionMetadata,PN);if(S=(d=F)==null?void 0:d.playlistId)q.playlistId=S;q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Mu(k.ih)?g.n(U,md(J,k.T,t,k.N,q),2):g.Qj(k.ih)?g.n(U,Dg(J,k.T,t,k.N),2):U.oY(2)}return g.n(U,UJQ(g.e(p.frameworkUpdates,VW)),0)})},GV=function(k,p,t,J,q,F){return new QW(p?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",E7(k),t,J,q,F)},R8L=function(k,p,t){p=l0S(k.ih,t.cotn,p);
t=g.Jx(p);return g.zBS(p,t,k.ih)},BZS=function(k,p){var t,J,q,F,d,S,U,f,b,N,y;
return g.Q(function(Y){if(Y.T==1)return t=[],g.n(Y,jy(k.T,{mode:"readonly",RO:!0},function(T){var A=[],V=p.offlineVideoStreams;if(V){V=g.Z(V);for(var D=V.next();!D.done;D=V.next())A.push(ey(T,D.value,"offlineVideoStreams"))}return g.Z4.all(A)}),2);
if(J=Y.Y)for(q=g.Z(J),F=q.next();!F.done;F=q.next())if(d=F.value,S=void 0,(S=d)==null?0:S.streamsProgress)for(U=d.streamsProgress,f=0;f<U.length;f++)b=U[f],N=JSON.parse(b.formatStreamBytes),y={itag:N.itag,lmt:N.lastModified,xtags:N.xtags},t.push(y);return Y.return(t)})},e8R=function(k,p){this.T=k;
this.ih=p},h8S=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y;
return g.Q(function(T){switch(T.T){case 1:return t=E7(p),g.n(T,Hq(k.T,"videoPlaybackPositionEntity"),2);case 2:J=T.Y;if(J.length===0)return T.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Aw(T,3);return g.n(T,RR.getInstance(),5);case 5:q=T.Y;if(!q)throw Error("prefStorage is undefined");return g.n(T,q.get("psi"),6);case 6:return F=T.Y,U=(S=(d=F)==null?void 0:d.Of)!=null?S:"0",g.n(T,cfL(J,U),7);case 7:return f=T.Y,b={isPaused:f.watchHistoryPaused,Of:f.syncTimestampUsec},g.n(T,q.set("psi",
b),8);case 8:if(b.isPaused){T.oY(9);break}N=g.e(f.frameworkUpdates,VW);if(!f.frameworkUpdates||!N){T.oY(9);break}return g.n(T,UJQ(N),9);case 9:g.Vi(T,4);break;case 3:return y=g.W9(T),Y="PPE handleRefresh error: "+(y instanceof Error?y.message:"unknown error"),JU(Y),T.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return T.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},MLK=function(k,p){var t,J,q,F,d,S,U,f;
return g.Q(function(b){switch(b.T){case 1:return t=E7(p),J=g.uo(p.entityKey).entityId,g.Aw(b,2),g.n(b,RR.getInstance(),4);case 4:q=b.Y;if(!q)throw Error("prefStorage is undefined");return g.n(b,q.get("psi"),5);case 5:F=b.Y;d=g.e(p.actionMetadata,aH9);if(((S=F)==null?void 0:S.isPaused)!==!1||(U=d)==null||!U.lastPlaybackPositionSeconds){b.oY(6);break}f={key:g.o0(J,"videoPlaybackPositionEntity"),videoId:J,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.n(b,Oz(k.T,f,"videoPlaybackPositionEntity"),
6);case 6:g.Vi(b,3);break;case 2:return g.W9(b),b.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},g89=function(k,p){var t,J,q;
return g.Q(function(F){switch(F.T){case 1:t=E7(p);g.Aw(F,2);J=g.uo(p.entityKey).entityId;if(J==="!*$_ALL_ENTITIES_!*$")return g.n(F,FSn(k.T),5);q=g.o0(J,"videoPlaybackPositionEntity");return g.n(F,qHA(k.T,q),5);case 5:g.Vi(F,3);break;case 2:return g.W9(F),F.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},u2W=function(k,p){this.api=k;
this.T=p;this.logger=new g.xO("woffle");this.Y=!1;this.u3={Be:this.Be};this.logger.debug("Initialized OfflineMediaManager")},lHS=function(k){return g.Q(function(p){return p.return(rKq(k))})},jQK=function(k){var p;
return g.Q(function(t){if(t.T==1)return g.n(t,g.bJi(k),2);p=t.Y;return t.return(p.filter(function(J){return!!J.url}).map(function(J){return J.url}))})},Id=function(k,p){var t=g.Wx(p);
if(t===1||t===0)return Promise.resolve();(t=O6J(k,p))&&t.stopVideo();k.N=0;return lHS(p)},Xi=function(k,p,t,J){t=t===void 0?!1:t;
J=J===void 0?!0:J;var q=typeof p==="string"?p:p.videoDetails.videoId;g.Wx(q)===2&&((p=O6J(k,q))?p.stopVideo():k.logger.info(function(){return"Corresponding player for "+q+" not found. Pausing anyway"}),g.D_(q,2),k.N=2,t?Kyq(k.T):J&&H6c(k.T))},O6J=function(k,p){var t;
return((t=k.player)==null?void 0:t.getVideoData().videoId)===p?k.player:null},xR4=function(k,p,t){p.getPlayerResponse();
g.D_(p.videoId,2);k.N=2;k.Y=!1;var J;(J=k.player)==null||J.dispose();k.player=k.api.WD(p);p={};k.player.bY((p.localmediachange=k.BP,p.signatureexpired=k.Wr,p.statechange=k.FW0,p),k);var q=k.Be(t);k.player.EP(g.Kj(q,q,!0,"m"),!1);k.logger.debug(function(){return"Starting headless playback with quality: "+q});
k.player.BO(!1)},kt9=function(k,p){this.T=k;
this.ih=p},tFJ=function(k,p){var t,J;
return g.Q(function(q){switch(q.T){case 1:return t=E7(p),g.n(q,K3(k.T,p.entityKey,"transfer"),2);case 2:if(J=q.Y)return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Aw(q,3);return g.n(q,p8R(k,p),5);case 5:g.Vi(q,4);break;case 3:return g.W9(q),q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},J0L=function(k,p){var t,J;
return g.Q(function(q){switch(q.T){case 1:return t=E7(p),g.n(q,K3(k.T,p.entityKey,"transfer"),2);case 2:J=q.Y;if(!J||J.transferState!=="TRANSFER_STATE_COMPLETE")return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Aw(q,3);return g.n(q,p8R(k,p,!0),5);case 5:g.Vi(q,4);break;case 3:return g.W9(q),q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},o_S=function(k,p){var t,J,q,F,d,S,U,f,b,N;
return g.Q(function(y){switch(y.T){case 1:return t=E7(p),J=g.uo(p.entityKey).entityId,g.n(y,jy(k.T,{mode:"readonly",RO:!0},function(Y){var T=ey(Y,p.entityKey,"transfer");Y=ey(Y,g.o0(J,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Z4.all([T,Y])}),2);
case 2:q=y.Y;F=g.Z(q);d=F.next().value;S=F.next().value;U=d;f=S;if(!U||U.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return y.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Aw(y,3);U.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.n(y,Oz(k.T,U,"transfer"),5);case 5:b=g.uo(U.key).entityId;dW({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:b,A_:U,offlineModeType:(N=f)==null?void 0:N.offlineModeType});g.Vi(y,
4);break;case 3:return g.W9(y),y.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return y.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},p8R=function(k,p,t){t=t===void 0?!1:t;
var J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D;return g.Q(function(v){switch(v.T){case 1:return J=g.e(p.actionMetadata,qc9),q=g.uo(p.entityKey).entityId,F=g.o0(q,"downloadStatusEntity"),g.n(v,jy(k.T,{mode:"readonly",RO:!0},function(w){var X=ey(w,F,"downloadStatusEntity");w=ey(w,g.o0(q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Z4.all([X,w])}),2);
case 2:return d=v.Y,S=g.Z(d),U=S.next().value,f=S.next().value,b=U,N=f,y="TRANSFER_STATE_TRANSFER_IN_QUEUE",((Y=b)==null?void 0:Y.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(y="TRANSFER_STATE_PAUSED_BY_USER"),V={key:p.entityKey,transferState:y,cotn:g.Zi(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(T=J)==null?void 0:T.maximumDownloadQuality,preferredAudioTrack:(A=J)==null?void 0:A.preferredAudioTrack,transferRetryCount:0,isRefresh:t,hasLoggedFirstStarted:!1},g.n(v,jy(k.T,
{mode:"readwrite",RO:!0},function(w){var X=[];t&&X.push(gf(w,g.o0(q,"offlineVideoStreams")));X.push(My(w,V,"transfer"));return g.Z4.all(X)}),3);
case 3:if(!t){v.oY(4);break}return g.n(v,lHS(q),4);case 4:dW({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:q,A_:V,offlineModeType:(D=N)==null?void 0:D.offlineModeType}),g.CS(v)}})},$dn=function(k,p,t,J){if(!k.action.entityKey)throw Error("entityKey is missing.");
var q=g.uo(k.action.entityKey);q={entityType:q.k6,entityId:q.entityId,offlineOrchestrationActionType:k.action.actionType,orchestrationAction:{orchestrationActionId:k.actionId}};p&&(q.offlineOrchestrationActionResult=p.status,q.isRetryable=t?!1:p.T,p.N&&(q.offlineOrchestrationFailureReason=FEW(p.N,q.isRetryable)));var F,d;if((F=k.action.actionMetadata)==null?0:(d=F.offlineLoggingData)==null?0:d.offlineModeType)q.offlineModeType=k.action.actionMetadata.offlineLoggingData.offlineModeType;J&&(q.additionalOrchestrationActions=
J.map(function(S){return{orchestrationActionId:S.actionId}}));
return q},FEW=function(k,p){return k!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||p?k==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&p?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":k:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},dd4=function(k,p){var t={offlineOrchestrationContext:$dn(k)};
p=DJR(p,t);sp9(WSL(),p,k.rootActionId)},E_9=function(k,p,t,J){J=J===void 0?[]:J;
p={offlineOrchestrationContext:$dn(k,p,t,J)};p=DJR(3,p);sp9(WSL(),p,k.rootActionId)},Scc=function(){this.actions=[]},UdL=function(k,p){p=g.Z(p);
for(var t=p.next();!t.done;t=p.next())t=t.value,dd4(t,1),k.actions.push(t);k.actions.sort(k.T)},fUK=function(k,p){if(p)for(var t=0;t<k.actions.length;t++)if(p==="!*$_ALL_ENTITIES_!*$"&&k.actions[t].actionId!==p||p!=="!*$_ALL_ENTITIES_!*$"&&k.actions[t].rootActionId===p&&k.actions[t].actionId!==p)k.actions.splice(t,1),t--},b2C=function(k,p){k=g.Z(k.actions);
for(var t=k.next();!t.done;t=k.next())if(t.value.actionId===p)return!0;return!1},Rd=function(k,p,t,J,q){g.R.call(this);
var F=this;this.Y=k;this.NO=p;this.gy=t;this.Z=J;this.ih=q;this.T=new Scc;this.S=new g.MD;this.N=new g.jF(function(){F.retry()});
this.B=NaN;this.X=!1;this.u3={BPS:function(){return F.T},
Vf:function(){return F.S},
Lur:function(){return F.N},
retry:function(){return F.retry()}};
g.z(this,this.N);this.L=this.Y.observe(this.Y8.bind(this))},YcA=function(k,p,t,J,q){var F;
return g.Q(function(d){if(d.T==1)return F=new Rd(k,p,t,J,q),g.n(d,NlS(F),2);y0S(F);return d.return(F)})},y0S=function(k){var p=k.T.actions[0];
return k.C?((p==null?void 0:p.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&k.C[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(k.X=!0),Promise.resolve()):TlC(k)},TlC=function(k){var p,t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D;
return g.Q(function(v){switch(v.T){case 1:if(k.C)throw Error("Already processing an action");if(k.MO())return v.return();p=k.T.actions.shift();B54(k.gy,!p);if(p===void 0)return v.return();p.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&p.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&fUK(k.T,p.actionId);t="";p.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&p.rootActionId===p.actionId&&(t=p.actionId);J=[p];k.C=J;if(q=k.NO[p.entityType]){v.oY(2);break}k.C=
void 0;return g.n(v,TlC(k),3);case 3:return v.return();case 2:F=g.Z(J);for(d=F.next();!d.done;d=F.next())S=d.value,dd4(S,2);g.Aw(v,4,5);return g.n(v,QQC(q,J.map(function(w){return w.action})),7);
case 7:U=v.Y,f=g.Z(J),b=f.next();case 8:if(b.done){v.oY(10);break}N=b.value;y=U.get(N.action);return g.n(v,r0n(k,N,y),9);case 9:b=f.next();v.oY(8);break;case 10:fUK(k.T,t);case 5:g.Du(v);k.C=void 0;g.s0(v,6);break;case 4:return Y=g.W9(v),JU("Orchestration error",Y),g.Aw(v,12),g.n(v,Z2R(k,J),14);case 14:g.Vi(v,5);break;case 12:T=g.W9(v);JU("Orchestration retry error",T);A=g.Z(J);for(V=A.next();!V.done;V=A.next())D=V.value,D.retryScheduleIndex<3&&UdL(k.T,[D]);v.oY(5);break;case 6:return g.n(v,TlC(k),
0)}})},r0n=function(k,p,t){var J,q,F,d,S,U,f,b,N,y,Y,T;
return g.Q(function(A){switch(A.T){case 1:J=p.retryScheduleIndex+2===3;if(t.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){A.oY(2);break}if(t.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){A.oY(0);break}E_9(p,t,J);if(t.T&&p.retryScheduleIndex+1<3)return g.n(A,Z2R(k,[p]),0);F=((q=t)==null?0:q.Y)?t.Y:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:p.action.entityKey,failureReason:F};S=void 0;g.Mu(k.ih)?S="mainVideoDownloadStateEntity":g.Qj(k.ih)&&(S="musicTrackDownloadMetadataEntity");
if(!S||!t.downloadState){A.oY(7);break}U=g.uo(p.action.entityKey).entityId;return g.n(A,b8(U,S,k.Y,t.downloadState),7);case 7:qt(k.Z,d);if(t.downloadState==="DOWNLOAD_STATE_FAILED"&&k.ih.D("html5_auto_retry_failed_pde_actions")){A.oY(0);break}JU("Orchestration result is not retryable, deleting action");return g.n(A,qHA(k.Y,Zg(p).key),0);case 2:f=void 0;try{f=(b=t.C)==null?void 0:b.map(function(V){return k.createAction(V,p)})}catch(V){return E_9(p,t,J),N={entityKey:p.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},qt(k.Z,N),JU("Orchestration subactions creation error",V),A.return()}E_9(p,t,J,f);if(!f){A.oY(12);break}y=f.map(function(V){return Zg(V)});
Y=0;case 13:if(!(Y<f.length)||k.X){A.oY(15);break}return g.n(A,jy(k.Y,{mode:"readwrite",RO:!0},function(V){var D=[];D.push(jVA(V,y.slice(Y,Y+10),"offlineOrchestrationActionWrapperEntity"));return g.Z4.all(D)}),16);
case 16:Y+=10;A.oY(13);break;case 15:if(k.X)return k.X=!1,A.return();case 12:return T=Zg(p),g.n(A,qHA(k.Y,T.key),17);case 17:dd4(p,4),g.CS(A)}})},VF4=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y;
return g.Q(function(T){t=[];J=Infinity;q=4E3;F=g.Z(p);for(d=F.next();!d.done;d=F.next())S=d.value,U=Number(S.enqueueTimeSec),f=CvJ(U),b=S.retryScheduleIndex,N=b!=null&&b>0,f>0&&N?(J=Math.min(J,U),q=Math.min(f,q)):t.push(S);isFinite(J)&&(!k.N.isActive()||J<k.B)&&(k.B=J,k.N.start(q));k.S.FI()||(y=t.length,t=t.filter(function(A){var V;A=((V=A.actionProto)==null?void 0:V.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!A0a.includes(A)}),Y=t.length<y,!k.N.isActive()&&Y&&k.N.start(1));
t.length>0&&mdR(k,t);return g.n(T,y0S(k),0)})},Dd4=function(k){var p,t,J,q,F,d,S;
return g.Q(function(U){if(U.T==1)return g.n(U,WEQ(k),2);p=U.Y;t=[];J=g.Z(p);for(q=J.next();!q.done;q=J.next())F=q.value,d=g.uo(F.key),S=d.entityId,b2C(k.T,S)||t.push(F);return g.n(U,VF4(k,t),0)})},CvJ=function(k){k=k*1E3-Date.now();
return k>4E3?4E3:k},Z2R=function(k,p){var t,J,q;
return g.Q(function(F){t=g.Z(p);for(J=t.next();!J.done;J=t.next()){q=J.value;var d=void 0,S=void 0,U=((S=q.action)==null?void 0:(d=S.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;q.retryScheduleIndex<U.length&&(d=U[q.retryScheduleIndex]);q.T=d*1E3+Date.now();q.retryScheduleIndex++}return g.n(F,stJ(k,p),0)})},NlS=function(k){var p;
return g.Q(function(t){if(t.T==1)return g.n(t,Hq(k.Y,"offlineOrchestrationActionWrapperEntity"),2);p=t.Y;return g.n(t,VF4(k,p),0)})},mdR=function(k,p){p.length!==0&&p.forEach(function(t){t=rW(t);
t.retryScheduleIndex<3&&UdL(k.T,[t])})},WEQ=function(k,p){var t;
return g.Q(function(J){if(J.T==1)return g.n(J,Hq(k.Y,"offlineOrchestrationActionWrapperEntity",p),2);t=J.Y;return J.return(t.filter(f0S))})},stJ=function(k,p){if(p.length===0)return Promise.resolve([]);
p=p.map(function(t){return Zg(t)});
return oc9(k.Y,p)},LEq=function(k){this.fp=k;
this.T=void 0},v_A=function(k,p){var t,J,q,F;
return g.Q(function(d){t=p.videoId;J=!0;if(p.captionTracks.length)q=uZK(p),k.T=new g.Lg(k.fp,p,q);else if(p.Xn)F=g.moi(p),k.T=new g.cr(k.fp,p.Xn,t,F,p.MG,p.eventId),J=p.MG;else return d.return();return d.return(new Promise(function(S){var U;(U=k.T)==null||U.bj({eP:function(){return g.Q(function(f){if(f.T==1)return g.n(f,k.eP(t,J),2);S();g.CS(f)})},
DL:function(){}})}))})},c0K=function(k){var p;
return g.Q(function(t){if(t.T==1)return g.n(t,T5a(k),2);p=t.Y;return t.return(!!p&&p.length>0)})},BN=function(k){g.R.call(this);
this.T=k;this.Y=this.T.observe(this.N.bind(this))},n_a=function(k,p){var t,J,q,F,d,S,U;
return g.Q(function(f){switch(f.T){case 1:if(p.length===0)return f.return([]);t=p.map(function(b){return g.o0(b,"transfer")});
return g.n(f,Hq(k.T,"transfer",t),2);case 2:J=f.Y;q=J.filter(f0S).map(function(b){return g.uo(b.key).entityId});
F=p.filter(function(b){return q.indexOf(b)===-1});
if(F.length===0)return f.return([]);d=g.Z(F);S=d.next();case 3:if(S.done){f.oY(5);break}U=S.value;return g.n(f,lHS(U),4);case 4:S=d.next();f.oY(3);break;case 5:return f.return(F)}})},QtK=function(k,p,t,J,q,F){var d,S,U;
return g.Q(function(f){d="STREAM_TYPE_UNKNOWN";t.video&&t.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",JU("unexpected stream type")):t.video&&!t.audio?d="STREAM_TYPE_VIDEO":!t.video&&t.audio&&(d="STREAM_TYPE_AUDIO");S=g.o0(p,"offlineVideoStreams");U={numBytesDownloaded:q.toFixed(),numTotalBytes:F.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(J),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(t.itag):void 0};return g.n(f,jy(k,{mode:"readwrite",RO:!0},
function(b){var N=ey(b,S,"offlineVideoStreams"),y=ey(b,g.o0(p,"transfer"),"transfer");return g.Z4.all([N,y]).then(function(Y){Y=g.Z(Y);var T=Y.next().value;Y=Y.next().value;if(!Y)return gf(b,S).then(function(){});
var A=w8L(T);T=i2S(T,J,U,S);var V=My(b,T,"offlineVideoStreams");w8L(T)>A&&(Y.lastProgressTimeMs=Date.now().toString());A=[V];Y.offlineVideoStreams||(Y.offlineVideoStreams=[]);Y.offlineVideoStreams.indexOf(S)===-1&&(Y.offlineVideoStreams.push(S),A.push(My(b,Y,"transfer")));return g.Z4.all(A)})}),0)})},PvS=function(k,p){var t,J,q,F,d;
return g.Q(function(S){if(S.T==1)return t=g.o0(p,"offlineVideoStreams"),g.n(S,K3(k,t,"offlineVideoStreams"),2);J=S.Y;if(!J||!J.streamsProgress)return S.return();q=g.Z(J.streamsProgress);for(F=q.next();!F.done;F=q.next())d=F.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.n(S,Oz(k,J,"offlineVideoStreams"),0)})},i2S=function(k,p,t,J){if(k&&k.streamsProgress){J=k;
a:{p=p.itag+";"+p.xtags;for(var q=k.streamsProgress,F=0;F<q.length;F++){var d=JSON.parse(q[F].formatStreamBytes);if(d.itag+";"+d.xtags===p){q[F]=t;t=q;break a}}q.push(t);t=q}J.streamsProgress=t}else k={key:J,streamsProgress:[t]};return k},w8L=function(k){if(k==null?0:k.streamsProgress){var p=0;
k=k.streamsProgress;for(var t=0;t<k.length;t++){var J=k[t];isNaN(Number(J.numBytesDownloaded))?JU("stream progress bytes number invalid"):p+=Number(J.numBytesDownloaded)}return p}return 0},GtQ=function(k,p,t,J){g.R.call(this);
var q=this;this.Y=k;this.api=p;this.IY=t;this.Y8=J;this.S=new g.MD;this.C=new g.jF(function(){q.T&&q.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&q.S.FI()&&((q.T.transferRetryCount||0)<3?Xi(q.Z,q.X,!1,!1):Id(q.Z,q.X.videoDetails.videoId),q.LX("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.gy=this.j6=0;this.L=this.B=!1;this.W0=g.dU(this.api.G().experiments,"html5_transfer_processing_logs_interval");this.RY=new g.nC(this);this.u3={YHO:function(){return q.C},
hzT:function(){return q.Y8},
Vf:function(){return q.S}};
this.NO=this.Y.observe(this.rl.bind(this));this.Z=new u2W(p,this);this.k8=new LEq(p);this.P0=new BN(this.Y);this.qO=this.S.listen("publicytnetworkstatus-online",this.VY.bind(this));this.Oy=this.S.listen("publicytnetworkstatus-offline",this.X3S.bind(this));this.L=this.api.G().D("html5_less_transfer_processing_logs");g.z(this,this.RY);this.RY.V(p,"offlinetransferpause",this.fwT);g.Mu(this.api.G())?this.N="mainVideoDownloadStateEntity":g.Qj(this.api.G())&&(this.N="musicTrackDownloadMetadataEntity")},
IUR=function(k){return g.Q(function(p){if(p.T==1)p=g.n(p,yKL(),2);
else{var t=k.P0;var J=g.VX();J=Object.keys(J);t=n_a(t,J);p=g.n(p,t,0)}return p})},eZ=function(k,p){p=p===void 0?!1:p;
var t;return g.Q(function(J){if(J.T==1){if(k.T)throw Error("Already downloading a video");k.gy=0;k.B=!1;return g.n(J,X8n(k),2)}return J.T!=4?(t=J.Y,zk9(k.IY,!t),t&&k.S.FI()?p?g.n(J,new Promise(function(q){g.fY(q,1E3)}),4):J.oY(4):(!t&&k.T&&zV(k),J.oY(0))):g.n(J,RtS(k,t),0)})},BlA=function(k){return g.Q(function(p){if(p.T==1)return k.X?g.n(p,Id(k.Z,k.X.videoDetails.videoId),3):p.oY(0);
zV(k);g.CS(p)})},ztJ=function(k,p){var t,J,q;
return g.Q(function(F){switch(F.T){case 1:return g.Aw(F,2),(t=!!p.captionTracks.length||!!p.Xn)?g.n(F,c0K(p.videoId),4):F.return();case 4:return(J=F.Y)?F.return():g.n(F,v_A(k.k8,p),5);case 5:g.Vi(F,0);break;case 2:q=g.W9(F),JU("Caption downloading error",q,p.cotn),g.CS(F)}})},RtS=function(k,p){var t,J,q,F,d,S;
return g.Q(function(U){switch(U.T){case 1:if(k.B)return U.return();k.B=!0;k.T=p;t=g.uo(k.T.key);J=t.entityId;q=void 0;if(k.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.n(U,hU(k,J),7);if(k.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||k.T.transferRetryCount||k.T.hasLoggedFirstStarted){U.oY(3);break}return g.n(U,hU(k,J),5);case 5:return q=U.Y,k.T.hasLoggedFirstStarted=!0,g.n(U,etn(k),6);case 6:ekc({videoId:J,A_:k.T,offlineModeType:q},void 0,void 0,!0);U.oY(3);break;case 7:q=U.Y,
dW({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:J,A_:k.T,offlineModeType:q});case 3:return g.n(U,htC(k),8);case 8:return F=null,g.Aw(U,9),g.n(U,aUS(k,p),11);case 11:F=U.Y;k.X=F;g.Vi(U,10);break;case 9:return d=g.W9(U),JU("error getting player response",d,p.cotn),g.n(U,k.LX("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return U.return();case 10:return S=l0S(k.api.G(),p.cotn,F),g.n(U,ztJ(k,S),13);case 13:return g.n(U,jQK(S.videoId),
14);case 14:S.xS=U.Y,xR4(k.Z,S,p.maximumDownloadQuality),k.C.start(108E5),g.CS(U)}})},X8n=function(k){var p,t;
return g.Q(function(J){if(J.T==1)return g.n(J,Hq(k.Y,"transfer"),2);p=J.Y;t=p.filter(MFJ).sort(g_S);return t.length===0?J.return():J.return(t[0])})},htC=function(k){var p,t,J;
return g.Q(function(q){if(q.T==1){if(!k.T)return ad(k,"onTransferStart"),q.return();k.C.start(108E5);return g.n(q,Mt(k,"TRANSFER_STATE_TRANSFERRING"),2)}p=k.T;return(J=((t=p)==null?0:t.key)?g.uo(p.key).entityId:"")&&k.N?g.n(q,b8(J,k.N,k.Y,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):q.oY(0)})},Kyq=function(k){var p,t,J,q;
g.Q(function(F){switch(F.T){case 1:if(!k.T){ad(k,"onTransferPausedByUser");F.oY(2);break}p=k.T;k.C.stop();return g.n(F,Mt(k,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:J=((t=p)==null?0:t.key)?g.uo(p.key).entityId:"";if(!J||!k.N){F.oY(4);break}return g.n(F,b8(J,k.N,k.Y,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.n(F,hU(k,J),6);case 6:q=F.Y,hkn({videoId:J,A_:p,offlineModeType:q});case 2:zV(k),eZ(k),g.CS(F)}})},H6c=function(k){var p,t,J;
g.Q(function(q){if(q.T==1){if(!k.T)return ad(k,"onTransferPausedByNetwork"),q.return();k.C.stop();return g.n(q,Mt(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(q.T!=3)return p=k.T,(J=((t=p)==null?0:t.key)?g.uo(p.key).entityId:"")&&k.N?g.n(q,b8(J,k.N,k.Y,"DOWNLOAD_STATE_PAUSED"),3):q.oY(3);zV(k);g.CS(q)})},uLn=function(k){var p,t,J,q,F;
g.Q(function(d){switch(d.T){case 1:if(!k.T)return ad(k,"onTransferComplete"),d.return();p=k.T;k.C.stop();if(!p||!k.X){d.oY(2);break}t=l0S(k.api.G(),p.cotn,k.X);return g.n(d,ztJ(k,t),2);case 2:return g.n(d,Mt(k,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:q=((J=p)==null?0:J.key)?g.uo(p.key).entityId:"";if(!q||!k.N){d.oY(5);break}return g.n(d,b8(q,k.N,k.Y,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.n(d,PvS(k.Y,q),7);case 7:return g.n(d,hU(k,q),8);case 8:F=d.Y,dW({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:q,A_:p,offlineModeType:F}),zV(k),eZ(k),g.CS(d)}})},lUq=function(k,p,t){var J,q;
g.Q(function(F){switch(F.T){case 1:if(!k.T)return ad(k,"onTransferProgress: "+p),F.return();if(k.T.transferState==="TRANSFER_STATE_TRANSFERRING"){F.oY(2);break}return g.n(F,htC(k),2);case 2:J=Date.now();if(!(J-k.j6>1E3)){F.oY(4);break}k.j6=J;return g.n(F,QtK(k.Y,t.videoId,t.Y,t.DW,t.bytesDownloaded,t.T),5);case 5:if(k.L&&!(k.L&&J-k.gy>k.W0)){F.oY(4);break}k.gy=J;return g.n(F,hU(k,p),7);case 7:q=F.Y,ekc({videoId:p,A_:k.T,offlineModeType:q},t.bytesDownloaded,t.T);case 4:k.C.start(108E5),g.CS(F)}})},
jtQ=function(k){var p=(k.T.transferRetryCount||0)<3;
p&&(k=k.T,k.transferRetryCount=(k.transferRetryCount||0)+1);return p},O2c=function(k,p){p=p===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":p;
var t,J,q,F;return g.Q(function(d){if(d.T==1)return k.T||ad(k,"setTransferToFailed: "+p),t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p==="TRANSFER_FAILURE_REASON_NETWORK"?t="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":p==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.n(d,Mt(k,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",p),2);if(d.T!=3)return qt(k.Y8,{entityKey:(J=k.T)==null?void 0:J.key,failureReason:t}),
q=k.T?g.uo(k.T.key).entityId:"",g.n(d,hU(k,q),3);F=d.Y;var S={videoId:q,A_:k.T,offlineModeType:F},U=p,f={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};U&&(f.transferFailureReason=U,f.failureReason=a0R(U));dW(f,S);g.CS(d)})},Mt=function(k,p,t,J){var q;
return g.Q(function(F){if(F.T==1){if(!k.T)return ad(k,"saveTransferState: "+p),F.return();k.T.transferState=p;k.T.failureReason=J;g.Aw(F,2);return g.n(F,etn(k,function(d){return t?h8(d,"offlineVideoStreams",k.T.offlineVideoStreams).then(function(S){for(var U=g.Z(S),f=U.next();!f.done;f=U.next())if((f=f.value)&&f.streamsProgress){f=g.Z(f.streamsProgress);for(var b=f.next();!b.done;b=f.next())b.value.streamState=t}return jVA(d,S.filter(function(N){return!!N}),"offlineVideoStreams")}):g.Z4.resolve(void 0)}),
4)}if(F.T!=2)return g.Vi(F,0);
q=g.W9(F);return q instanceof g.fz&&q.type==="QUOTA_EXCEEDED"?g.n(F,k.LX("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):F.oY(0)})},etn=function(k,p){var t;
return g.Q(function(J){if(!k.T)return J.return();t=k.T;return g.n(J,jy(k.Y,{mode:"readwrite",RO:!0},function(q){var F=[My(q,t,"transfer")];p&&F.push(p(q));return g.Z4.all(F)}),0)})},zV=function(k){k.T=void 0;
k.X=void 0;k.C.stop()},aUS=function(k,p){var t,J,q,F,d;
return g.Q(function(S){if(S.T==1)return t=g.uo(p.key),J=t.entityId,q=g.o0(J,"playbackData"),g.n(S,K3(k.Y,q,"playbackData"),2);F=S.Y;if((d=F)==null?0:d.playerResponseJson)return S.return(JSON.parse(F.playerResponseJson));throw Error("No PlayerResponse found");})},ad=function(k,p){k.api.yT("woffle",{mcte:p});
JU("missing current transfer entity.")},hU=function(k,p){var t,J,q;
return g.Q(function(F){if(F.T==1)return g.n(F,K3(k.Y,g.o0(p,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);t=F.Y;return F.return((q=(J=t)==null?void 0:J.offlineModeType)!=null?q:void 0)})},MFJ=function(k){return KES[k.transferState]!==void 0},g_S=function(k,p){var t=KES[k.transferState],J=KES[p.transferState];
return t!==J?t-J:Number(k.enqueuedTimestampMs)-Number(p.enqueuedTimestampMs)},gW=function(k,p){var t=this;
this.ih=k;this.api=p;this.S=new g.MD;this.X=new g.yM;this.u3={eA:function(){return t.N.u3.eA()},
Vf:function(){return t.S},
VYh:function(){return t.N},
gt:function(){return t.gt()},
v_:function(){return t.v_()},
dL:function(){return t.dL()},
Ln:function(){return t.Ln()},
UI:function(){return t.UI()},
M6:function(J){return t.M6(J)}};
this.N=new I09(function(){return H2q(t)},function(){t.dL()},this.api.D5(),this.api.D.bind(this.api));
this.T=new od(this.api);XC4(this.N)},H2q=function(k){return g.Q(function(p){k.api.zb("onOrchestrationBecameLeader");
return g.n(p,k.v_(),0)})},k7q=function(k){var p,t;
return g.Q(function(J){if(J.T==1)return g.n(J,xV(),2);if(J.T!=3){p=J.Y;if(!p)return JU("PES is undefined"),J.return();k.Y=new GtQ(p,k.api,k.N,k.T);t=k.ME(p);return g.n(J,YcA(p,t,k.N,k.T,k.ih),3)}k.Z=J.Y;return g.n(J,xdS(k),0)})},xdS=function(k){var p;
return g.Q(function(t){switch(t.T){case 1:if(!k.Y)return JU("transferManager is undefined"),t.return();if(k.Y.T){t.oY(2);break}return g.n(t,eZ(k.Y),2);case 2:if(!k.ih.D("woffle_enable_main_downloads_library")){t.oY(4);break}return g.n(t,k.HE(),4);case 4:if(!k.ih.D("html5_offline_playback_position_sync")){t.oY(6);break}return g.n(t,k.gU(),7);case 7:return g.n(t,k.M6(864E5),6);case 6:return g.n(t,k.refreshAllStaleEntities(43200,!0),9);case 9:return g.n(t,k.t2(),10);case 10:if(!k.ih.D("html5_retry_downloads_for_expiration")){t.oY(11);
break}return g.n(t,k.UI(),11);case 11:return k.B=g.b6(function(){k.refreshAllStaleEntities(43200,!0);k.t2()},9E5),g.lk(g.OA(),function(){return k.Ln()}),g.n(t,xV(),13);
case 13:return p=t.Y,g.n(t,GT4(p),14);case 14:RkW(k.N),g.CS(t)}})},pp4=function(){var k,p,t,J,q,F;
return g.Q(function(d){switch(d.T){case 1:return g.n(d,xV(),2);case 2:k=d.Y;if(!k)return d.return([]);p=Date.now()/1E3;return g.n(d,Hq(k,"offlineVideoPolicy"),3);case 3:t=d.Y,J=g.Z(t),q=J.next();case 4:if(q.done){d.oY(6);break}F=q.value;if(!(F.expirationTimestamp&&Number(F.expirationTimestamp)<p)){d.oY(5);break}F.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";F.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.n(d,Oz(k,F,"offlineVideoPolicy"),5);
case 5:q=J.next();d.oY(4);break;case 6:return d.return(t.map(function(S){return S.key}))}})},u8=function(k,p,t,J,q){var F,d,S;
return g.Q(function(U){if(U.T==1)return g.n(U,xV(),2);F=U.Y;if(!F)return U.return([]);d=p.map(function(f){var b=g.o0(f,t);b={actionType:J,entityKey:b,actionMetadata:Object.assign({},jpC(),q)};J!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(b.actionMetadata.priority=0);f=new TV(t,f,b);return Zg(f)});
S=oc9(F,d);XC4(k.N);return U.return(S)})},tIc=function(k,p,t,J){var q,F,d,S,U,f,b,N;
return g.Q(function(y){switch(y.T){case 1:q=[],F=g.Z(p),d=F.next();case 2:if(d.done){y.oY(4);break}S=d.value;if(S.upToDate||t&&!S.shouldAutoSyncMetadata||!S.playlistId){y.oY(3);break}U={};switch(J){case "mainPlaylistEntity":f={nextAutoRefreshIntervalSeconds:S.checkInSeconds,autoSync:t};U={mainPlaylistEntityActionMetadata:f};break;case "musicPlaylist":b={autoSync:t},U={musicPlaylistEntityActionMetadata:b}}return g.n(y,u8(k,[S.playlistId],J,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U),6);case 6:(N=
y.Y)&&q.push.apply(q,g.m(N));case 3:d=F.next();y.oY(2);break;case 4:return y.return(q)}})},JBc=function(k,p){var t;
return g.Q(function(J){return p.length?(t=jpC(),g.Il(t,PN,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k.api.yT("qrd",{v:p.length}),J.return(u8(k,p,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t))):J.return([])})},oEC=function(k,p,t){this.T=k;
this.ih=p;this.N=t},$Na=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v;
return g.Q(function(w){switch(w.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,F=[],g.Aw(w,2),g.n(w,qiJ(k,q),4);case 4:F=w.Y;if(!(k.ih.D("woffle_enable_main_downloads_library")&&((d=F)==null?0:d.length))){w.oY(5);break}return g.n(w,dRa(k.T,[p.entityKey]),5);case 5:g.Vi(w,3);break;case 2:return S=g.W9(w),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.fz&&S.type==="QUOTA_EXCEEDED"?(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):JU("Playlist add error"),w.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,U,f));case 3:b=[];if(!k.ih.D("html5_offline_prevent_redownload_downloaded_video")){w.oY(7);break}return g.n(w,ujJ(k.T,"mainVideoEntity",F),8);case 8:F=w.Y;case 7:if((N=F)==null?0:N.length)for(y=g.Z(F),Y=y.next();!Y.done;Y=y.next())if(T=Y.value,A=T.offlineVideoData,V=void 0,(V=A)==null?0:V.videoId)D=void 0,v=Number(((D=p.actionMetadata)==null?void 0:D.priority)||
0)+1,b.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A.videoId,"mainVideoEntity",v,l8,F6S(p,A,q)));return w.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,b))}})},EEW=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn,W,L,c,P,I,pS,q_,Fe,G,U0,Yh,E0,wT,NQ,RL,bP,M_,B4,Eb,wx,ML,Uk,h1,ze,an,Ce,fE,wv,b5,ig,ip,QQ,sL,H4,Ma,Jj,mE,I3;
return g.Q(function(NW){switch(NW.T){case 1:return t=E7(p),J=p.entityKey,q=g.uo(J).entityId,F=[],d=!1,q==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.n(NW,Hq(k.T,"mainPlaylistEntity"),5)):g.n(NW,K3(k.T,J,"mainPlaylistEntity"),4);case 4:(S=NW.Y)&&F.push(S);NW.oY(3);break;case 5:F=NW.Y;case 3:if((U=F)==null||!U.length)return NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));f=g.e(p.actionMetadata,dNS);N=(b=f)==null?void 0:b.nextAutoRefreshIntervalSeconds;Y=(y=f)==null?void 0:y.autoSync;T=[];V=A=
!0;D=!1;if(!d&&Y===!1){NW.oY(6);break}g.Aw(NW,7);return g.n(NW,mRq(0,!!Y,!0,F),9);case 9:T=NW.Y;g.Vi(NW,8);break;case 7:v=g.W9(NW);if(!(v instanceof Error&&v.message==="No data")){v instanceof Error&&v.message==="Empty response body"&&JU(v.message);NW.oY(8);break}return q==="!*$_ALL_ENTITIES_!*$"?g.n(NW,tLJ(k.T,p,k.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.n(NW,kfR(q,k.T,p,k.N),8);case 8:if(!T.length||!d&&T[0].playlistId!==q)return NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));case 6:if(d){w=[];X=g.Z(T);for(B=X.next();!B.done;B=X.next())O=B.value,O.upToDate||Y&&!O.shouldAutoSyncMetadata||!O.playlistId||(l={nextAutoRefreshIntervalSeconds:O.checkInSeconds,autoSync:Y},w.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O.playlistId,"mainPlaylistEntity",0,l8,{mainPlaylistEntityActionMetadata:l})));return NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,w))}T.length&&(oi=T[0],D=!!oi.upToDate,Y&&(A=($h=oi.shouldAutoSyncMetadata)!=null?$h:!0,V=(kh=oi.shouldAutoSyncVideos)!=
null?kh:!0,oi.checkInSeconds&&(N=oi.checkInSeconds)));if(D||!A)return NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));h=[];x=F[0];if(!x.downloadState){C=void 0;NW.oY(15);break}return g.n(NW,K3(k.T,x.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:C=NW.Y;case 15:return a=C,AC=((zL=a)==null?0:zL.addedTimestampMillis)?String(a.addedTimestampMillis):void 0,g.Aw(NW,17),g.n(NW,qiJ(k,q,AC,N),19);case 19:h=NW.Y;g.Vi(NW,18);break;case 17:bJ=g.W9(NW);if(!(bJ instanceof Error&&
bJ.message==="No data for playlist")){if(bJ instanceof Error&&bJ.message==="Empty response body for playlist")JU(bJ.message);else return LS="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",KS="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bJ instanceof g.fz&&bJ.type==="QUOTA_EXCEEDED"&&(LS="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",KS="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,LS,KS));NW.oY(18);
break}return g.n(NW,kfR(q,k.T,p,k.N),18);case 18:if(!V)return NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));JC=[];Yn=new Map;if((W=h)==null?0:W.length)for(L=g.Z(h),c=L.next();!c.done;c=L.next())P=c.value,I=P.offlineVideoData,pS=void 0,((pS=I)==null?0:pS.videoId)&&Yn.set(I.videoId,I);q_=new Map;Fe=[];if((G=x)==null?0:(U0=G.videos)==null?0:U0.length)for(Yh=g.Z(x.videos),E0=Yh.next();!E0.done;E0=Yh.next())if(wT=E0.value,NQ=JSON.parse(g.uo(wT).entityId),RL=NQ.videoId)Yn.has(RL)?(q_.set(RL,
Yn.get(RL)),Yn.delete(RL)):Fe.push(RL);M_=Number(((bP=p.actionMetadata)==null?void 0:bP.priority)||0)+1;B4=g.Z(Yn.entries());for(Eb=B4.next();!Eb.done;Eb=B4.next())wx=Eb.value,ML=g.Z(wx),Uk=ML.next().value,h1=ML.next().value,ze=Uk,an=h1,JC.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ze,"mainVideoEntity",M_,l8,F6S(p,an,q)));Ce=g.Z(q_.entries());for(fE=Ce.next();!fE.done;fE=Ce.next())wv=fE.value,b5=g.Z(wv),ig=b5.next().value,ip=b5.next().value,QQ=ig,sL=ip,JC.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
QQ,"mainVideoEntity",M_,l8,F6S(p,sL,q)));H4=g.Z(Fe);for(Ma=H4.next();!Ma.done;Ma=H4.next())Jj=Ma.value,mE={playlistId:q},I3={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:mE},JC.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Jj,"mainVideoEntity",0,l8,I3));return NW.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,JC))}})},SiS=function(k,p){var t,J,q,F;
return g.Q(function(d){switch(d.T){case 1:return t=E7(p),g.Aw(d,2),J=g.uo(p.entityKey).entityId,J==="!*$_ALL_ENTITIES_!*$"?g.n(d,tLJ(k.T,p,k.N,(q=p.actionMetadata)==null?void 0:(F=q.offlineLoggingData)==null?void 0:F.offlineDeleteReason),5):g.n(d,kfR(J,k.T,p,k.N),6);case 6:if(!k.ih.D("woffle_enable_main_downloads_library")){d.oY(5);break}return g.n(d,E8K(k.T,p.entityKey),5);case 5:g.Vi(d,3);break;case 2:return g.W9(d),d.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},qiJ=function(k,p,t,J){var q,F,d,S,U,f,b;
return g.Q(function(N){switch(N.T){case 1:return g.n(N,CDq([p]),2);case 2:return q=N.Y,g.n(N,UNS(k,q[0],t,J),3);case 3:return F=N.Y,d=F.mainPlaylistEntity,S=F.ty8,f=HZS(d,(U=S)==null?void 0:U.avatar),g.Aw(N,4),g.n(N,AU(f),6);case 6:g.Vi(N,5);break;case 4:b=g.W9(N),b instanceof Error&&b.message==="Failed to fetch"&&JU(b.message);case 5:return N.return(q[0].videos)}})},UNS=function(k,p,t,J){var q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X;
return g.Q(function(B){switch(B.T){case 1:q=Date.now().toString();t||(t=q);F=p.videos;d=p.playlistId;S=[];U=[];if(F)for(f=g.Z(F),b=f.next();!b.done;b=f.next()){N=b.value;y=N.offlineVideoData;if(!y||!y.videoId)throw JU("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");Y=y.videoId;T={videoId:Y,playlistId:d};A={id:g.o0(JSON.stringify(T),"mainPlaylistVideoEntity"),video:g.o0(Y,"mainVideoEntity")};S.push(A);U.push(A.id)}D={key:g.o0(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:t,lastSyncedTimestampMillis:q};v={key:g.o0(d,"mainPlaylistEntity"),playlistId:d,videos:U,title:p.title,thumbnailStyleData:fqR(p),visibility:bva(p),downloadState:D.key};p.channel&&(w=p.channel.offlineChannelData,V=NQC(g.o0(d,"ytMainChannelEntity"),w),v.channelOwner=V.id);((X=v)==null?0:X.entityMetadata)?(v.entityMetadata.offlineLastModifiedTimestampSeconds=p.lastModifiedTimestamp,J&&(v.entityMetadata.nextAutoRefreshIntervalSeconds=String(J))):v&&(v.entityMetadata={nextAutoRefreshIntervalSeconds:J?
String(J):void 0,offlineLastModifiedTimestampSeconds:p.lastModifiedTimestamp});g.Aw(B,2);return g.n(B,jy(k.T,{mode:"readwrite",RO:!0},function(O){var l=My(O,v,"mainPlaylistEntity"),oi=My(O,D,"mainPlaylistDownloadStateEntity");l=[l,oi];oi=g.Z(S);for(var $h=oi.next();!$h.done;$h=oi.next())l.push(My(O,$h.value,"mainPlaylistVideoEntity"));V&&l.push(My(O,V,"ytMainChannelEntity"));return g.Z4.all(l)}),4);
case 4:g.Vi(B,3);break;case 2:throw g.W9(B),JU("PES failure for playlist"),Error("PES failure for playlist");case 3:return B.return({mainPlaylistEntity:v,ty8:V,LpT:S})}})},NQC=function(k,p){return{id:k,
channelId:p.channelId,title:p.title,avatar:p.thumbnail}},fqR=function(k){var p=[],t=k.videos;
t&&t.length>0&&p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:t[0].offlineVideoData.thumbnail}}});if((k=k.additionalMetadadatas)&&k.length>0)for(k=g.Z(k),t=k.next();!t.done;t=k.next()){var J=t.value.offlineBundleItemPlaylistData,q=void 0;t=(q=J)==null?void 0:q.style;q=void 0;J={collageThumbnail:{coverThumbnail:(q=J)==null?void 0:q.coverThumbnail}};switch(t){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:J});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:J});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:J});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":p.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:J})}}return p},bva=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},F6S=function(k,p,t){p={offlineVideoData:p,
playlistId:t};if(k=g.e(k.actionMetadata,dNS))p.maximumDownloadQuality=k.maximumDownloadQuality;return{mainVideoEntityActionMetadata:p}},yBa=function(k,p,t){this.T=k;
this.ih=p;this.N=t},rBq=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T;
return g.Q(function(A){switch(A.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,F=g.e(p.actionMetadata,jZ),S=!((d=F)==null?0:d.playlistId),g.Aw(A,2),g.n(A,Yia(k,q,void 0,(U=F)==null?void 0:U.offlineVideoData,S),4);case 4:g.Vi(A,3);break;case 2:return f=g.W9(A),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.fz&&f.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
A.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,b,N));case 3:y=1;y=Number(((Y=p.actionMetadata)==null?void 0:Y.priority)||0)+1;var V=(V=g.e(p.actionMetadata,jZ))?{playbackDataActionMetadata:{maximumDownloadQuality:V.maximumDownloadQuality}}:void 0;T=i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"playbackData",y,TQS,V);return A.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,[T]))}})},ZvS=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v;
return g.Q(function(w){switch(w.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,g.n(w,K3(k.T,p.entityKey,"mainVideoEntity"),2);case 2:F=w.Y;if(!F){d=void 0;w.oY(3);break}return g.n(w,K3(k.T,F.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=w.Y;case 3:S=d;if(!F||!S)return w.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));g.Aw(w,5);return g.n(w,Yia(k,q,S.addedTimestampMillis,(f=g.e(p.actionMetadata,jZ))==null?void 0:f.offlineVideoData),7);case 7:b=1;b=Number(((N=
p.actionMetadata)==null?void 0:N.priority)||0)+1;U=i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"playbackData",b,TQS);g.Vi(w,6);break;case 5:y=g.W9(w);if(!(y instanceof Error&&y.message==="No data")){if(y instanceof Error&&y.message==="Empty response body")JU(y.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.fz&&y.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),w.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,Y,T));w.oY(6);break}return g.n(w,WN(k.T,q),9);case 9:A=w.Y;V=g.e(p.actionMetadata,jZ);if(v=(D=V)==null?void 0:D.playlistId)A.playlistId=v;A.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.n(w,md(q,k.T,p,k.N,A),6);case 6:return w.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,U?[U]:void 0))}})},CuR=function(k,p){var t,J,q,F,d,S,U,f,b,N;
return g.Q(function(y){switch(y.T){case 1:return t=E7(p),g.Aw(y,2),J=g.uo(p.entityKey).entityId,J==="!*$_ALL_ENTITIES_!*$"?g.n(y,tLJ(k.T,p,k.N,(b=p.actionMetadata)==null?void 0:(N=b.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.n(y,WN(k.T,J),6);case 6:q=y.Y;F=g.e(p.actionMetadata,jZ);if(S=(d=F)==null?void 0:d.playlistId)q.playlistId=S;q.offlineDeleteReason=(U=p.actionMetadata)==null?void 0:(f=U.offlineLoggingData)==null?void 0:f.offlineDeleteReason;return g.n(y,md(J,k.T,p,k.N,q),7);
case 7:if(!k.ih.D("woffle_enable_main_downloads_library")){y.oY(5);break}return g.n(y,E8K(k.T,p.entityKey),5);case 5:g.Vi(y,3);break;case 2:return g.W9(y),y.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return y.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t))}})},Yia=function(k,p,t,J,q){var F,d,S,U,f,b;
return g.Q(function(N){switch(N.T){case 1:if(F=J){N.oY(2);break}return g.n(N,Z6a([p]),3);case 3:d=N.Y,F=d[0];case 2:return g.n(N,ABK(k,F,t,q),4);case 4:S=N.Y;U=S.mainVideoEntity;f=S.channelEntity;g.Aw(N,5);var y=Yv(U.thumbnail),Y=Yv(f.avatar);return g.n(N,AU(y.concat(Y)),7);case 7:g.Vi(N,0);break;case 5:b=g.W9(N),b instanceof Error&&b.message==="Failed to fetch"&&JU(b.message),g.CS(N)}})},ABK=function(k,p,t,J){var q,F,d,S,U,f,b,N,y,Y,T,A,V;
return g.Q(function(D){switch(D.T){case 1:t||(t=Date.now().toString());F=(q=p.channel)==null?void 0:q.offlineChannelData;d={id:g.o0(p.videoId,"ytMainChannelEntity"),channelId:F.channelId,title:F.title,avatar:F.thumbnail};S={key:g.o0(p.videoId,"mainVideoDownloadStateEntity"),playbackData:g.o0(p.videoId,"playbackData"),addedTimestampMillis:t,videoDownloadContextEntity:g.o0(p.videoId,"videoDownloadContextEntity")};U={key:g.o0(p.videoId,"videoPlaybackPositionEntity"),videoId:p.videoId,lastPlaybackPositionSeconds:"0"};
k.ih.D("html5_offline_playback_position_sync")&&(f={playbackPosition:U.key});b=g.o0(p.videoId,"mainVideoEntity");N={key:b,videoId:p.videoId,title:p.title,thumbnail:p.thumbnail,localizedStrings:{viewCount:p.shortViewCountText},userState:f,lengthSeconds:p.lengthSeconds?Number(p.lengthSeconds):void 0,publishedTimestampMillis:p.publishedTimestamp?(Number(p.publishedTimestamp)*1E3).toString():void 0,formattedDescription:p.description,owner:d.id,downloadState:S.key};if(!k.ih.D("woffle_enable_main_downloads_library")||
!J){D.oY(2);break}return g.n(D,$RC(k.T,[b]),3);case 3:if(T=D.Y)y=T.mainDownloadsLibraryEntity,Y=T.mainDownloadsListEntity;case 2:return V=gcc,A={key:g.o0(p.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Il(S,V,A),g.n(D,jy(k.T,{mode:"readwrite",RO:!0},function(v){var w=My(v,d,"ytMainChannelEntity"),X=My(v,S,"mainVideoDownloadStateEntity"),B=My(v,N,"mainVideoEntity");w=[w,X,B];k.ih.D("html5_offline_playback_position_sync")&&(X=My(v,U,"videoPlaybackPositionEntity"),
w.push(X));y&&(X=My(v,y,"mainDownloadsLibraryEntity"),w.push(X));Y&&(X=My(v,Y,"mainDownloadsListEntity"),w.push(X));A&&(v=My(v,A,"downloadStatusEntity"),w.push(v));return g.Z4.all(w)}),4);
case 4:return D.return({mainVideoEntity:N,channelEntity:d})}})},mNq=function(k,p,t){this.T=k;
this.ih=p;this.N=t},W6c=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x;
return g.Q(function(C){switch(C.T){case 1:return t=E7(p),J=[],g.n(C,RR.getInstance(),2);case 2:q=C.Y;if(!q){C.oY(3);break}return g.n(C,q.get("sdois"),4);case 4:return F=C.Y,g.n(C,(S=q)==null?void 0:S.get("lmqf"),5);case 5:d=C.Y;case 3:g.Aw(C,6);if(F===void 0)throw Error("prefStorage or opt-in state is undefined");U=[];if(F){C.oY(8);break}return g.n(C,FyS(k.T),9);case 9:U=C.Y,U.reverse();case 8:if(!U.length){C.oY(10);break}f=g.Z(U);b=f.next();case 11:if(b.done){C.oY(10);break}N=b.value;if(!N){C.oY(12);
break}y=g.uo(N).entityId;return g.n(C,WN(k.T,y),14);case 14:return Y=C.Y,Y.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.n(C,md(y,k.T,{entityKey:N,actionType:p.actionType},k.N,Y),12);case 12:b=f.next();C.oY(11);break;case 10:return g.n(C,Wya(F,(T=d)!=null?T:"SD"),16);case 16:return A=C.Y,g.n(C,JfK(A),17);case 17:V=qUJ(A);if(!k.ih.D("woffle_enable_main_downloads_library")){C.oY(18);break}if(F){C.oY(19);break}return g.n(C,E8K(k.T,g.Py),19);case 19:return g.n(C,dRa(k.T,[g.Py]),18);
case 18:if((D=V)==null?0:D.length)for(v=g.Z(V),w=v.next();!w.done;w=v.next())if(B=X=w.value,O=B.actionType,l=B.entityKey,oi=B.actionMetadata,O&&l&&oi&&!g.e(oi,VIa)){O==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(oi.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if($h=g.e(X.actionMetadata,jZ))$h.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",X.actionMetadata=Object.assign({},X.actionMetadata,{mainVideoEntityActionMetadata:$h});J.push(X)}g.Vi(C,7);break;
case 6:return kh=g.W9(C),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",kh instanceof g.fz&&kh.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,h,x));case 7:return C.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,J))}})},DNA=function(){gW.apply(this,arguments);
this.L="mainVideoEntity"},sbq=function(k,p,t){p=p===void 0?43200:p;
t=t===void 0?!0:t;var J=J===void 0?!1:J;var q,F,d;return g.Q(function(S){switch(S.T){case 1:if(!k.S.FI())return S.return([]);q=[];g.Aw(S,2);return g.n(S,mRq(p,t,J),4);case 4:q=S.Y;g.Vi(S,3);break;case 2:F=g.W9(S),F instanceof Error&&F.message==="No data"||F instanceof Error&&F.message==="Empty response body"&&JU(F.message);case 3:return d=tIc(k,q,t,"mainPlaylistEntity"),S.return(d)}})},L6S=function(k,p,t,J){J=J===void 0?!1:J;
var q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v;return g.Q(function(w){switch(w.T){case 1:return q=[],g.n(w,VLS(),2);case 2:return(F=w.Y)||J?g.n(w,DRW(p,t),3):w.return([]);case 3:d=w.Y;if((S=d)==null||!S.length)return w.return([]);U={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};f=g.Z(d);b=f.next();case 4:if(b.done){w.oY(6);break}y=N=b.value;Y=y.actionType;T=y.entityKey;A=y.actionMetadata;if(!(Y&&T&&A)||g.e(A,VIa)){w.oY(5);break}Y==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(A.offlineLoggingData=
U);V=g.uo(T);D=V.entityId;return g.n(w,u8(k,[D],"mainVideoEntity",Y,A),8);case 8:v=w.Y,q=q.concat(v);case 5:b=f.next();w.oY(4);break;case 6:return w.return(q)}})},vES=function(k,p){this.T=k;
this.N=p},nER=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D;
return g.Q(function(v){switch(v.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,F=[],g.Aw(v,2),g.n(v,cBQ(k,q),4);case 4:F=v.Y;if((d=F)==null||!d.length){v.oY(5);break}return g.n(v,NZC(k.T,p.entityKey),5);case 5:g.Vi(v,3);break;case 2:return S=g.W9(v),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.fz&&S.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,U,f));case 3:return b=[],g.n(v,ujJ(k.T,"musicTrack",F),7);case 7:F=v.Y;if(F.length)for(N=g.Z(F),y=N.next();!y.done;y=N.next())if(Y=y.value,T=Y.offlineVideoData,A=void 0,(A=T)==null?0:A.videoId)V=void 0,D=Number(((V=p.actionMetadata)==null?void 0:V.priority)||0)+1,b.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",D,O7,vN(p,T,q)));return v.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,b))}})},
wpA=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn,W,L,c,P,I,pS,q_,Fe,G,U0,Yh,E0,wT,NQ,RL,bP,M_,B4,Eb,wx,ML,Uk,h1;
return g.Q(function(ze){switch(ze.T){case 1:return t=E7(p),J=p.entityKey,q=g.uo(J).entityId,F=[],d=!1,q==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.n(ze,Hq(k.T,"musicAlbumRelease"),5)):g.n(ze,K3(k.T,J,"musicAlbumRelease"),4);case 4:(S=ze.Y)&&F.push(S);ze.oY(3);break;case 5:F=ze.Y;case 3:if((U=F)==null||!U.length)return ze.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));if(d){f=[];b=g.Z(F);for(N=b.next();!N.done;N=b.next())y=N.value,Y=g.uo(y.id).entityId,f.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Y,"musicAlbumRelease",0,O7));return ze.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,f))}T=[];A=F[0];V=void 0;if(!A.downloadMetadata){ze.oY(6);break}return g.n(ze,K3(k.T,A.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:D=ze.Y,V=Number((w=(v=D)==null?void 0:v.addedTimestampMillis)!=null?w:"0")/1E3;case 6:return g.Aw(ze,8),g.n(ze,cBQ(k,q,(X=V)==null?void 0:X.toString()),10);case 10:T=ze.Y;g.Vi(ze,9);break;case 8:B=g.W9(ze);if(!(B instanceof Error&&B.message===
"No data")){if(B instanceof Error&&B.message==="Empty response body")JU(B.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.fz&&B.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ze.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,O,l));ze.oY(9);break}return g.n(ze,s7(q,"musicAlbumRelease",k.T,
p,k.N),9);case 9:oi=[];$h=new Map;if((kh=T)==null?0:kh.length)for(h=g.Z(T),x=h.next();!x.done;x=h.next())C=x.value,a=C.offlineVideoData,zL=void 0,((zL=a)==null?0:zL.videoId)&&$h.set(a.videoId,a);AC=new Map;bJ=[];if((LS=A)==null?0:(KS=LS.tracks)==null?0:KS.length)for(JC=g.Z(A.tracks),Yn=JC.next();!Yn.done;Yn=JC.next())if(W=Yn.value,L=g.uo(W).entityId)$h.has(L)?(AC.set(L,$h.get(L)),$h.delete(L)):bJ.push(L);P=Number(((c=p.actionMetadata)==null?void 0:c.priority)||0)+1;I=g.Z($h.entries());for(pS=I.next();!pS.done;pS=
I.next())q_=pS.value,Fe=g.Z(q_),G=Fe.next().value,U0=Fe.next().value,Yh=G,E0=U0,oi.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Yh,"musicTrack",P,O7,vN(p,E0)));wT=g.Z(AC.entries());for(NQ=wT.next();!NQ.done;NQ=wT.next())RL=NQ.value,bP=g.Z(RL),M_=bP.next().value,B4=bP.next().value,Eb=M_,wx=B4,oi.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Eb,"musicTrack",P,O7,vN(p,wx)));ML=g.Z(bJ);for(Uk=ML.next();!Uk.done;Uk=ML.next())h1=Uk.value,oi.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",h1,
"musicTrack",0,O7));return ze.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,oi))}})},ivA=function(k,p){var t,J;
return g.Q(function(q){switch(q.T){case 1:return t=E7(p),g.Aw(q,2),J=g.uo(p.entityKey).entityId,J==="!*$_ALL_ENTITIES_!*$"?g.n(q,Li(k.T,p,k.N),5):g.n(q,s7(J,"musicAlbumRelease",k.T,p,k.N),6);case 6:return g.n(q,yfc(k.T,p.entityKey),5);case 5:g.Vi(q,3);break;case 2:return g.W9(q),q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},cBQ=function(k,p,t){var J,q,F;
return g.Q(function(d){switch(d.T){case 1:return g.n(d,CDq([p]),2);case 2:return J=d.Y,g.n(d,QbR(k,J[0],t),3);case 3:return q=d.Y,F=Yv(q.thumbnailDetails),g.n(d,AU(F),4);case 4:return d.return(J[0].videos)}})},QbR=function(k,p,t){var J,q,F,d,S,U,f,b,N,y,Y,T,A,V;
return g.Q(function(D){if(D.T==1){J=p.additionalMetadadatas;q=void 0;if(J&&J.length>0)for(F=g.Z(J),d=F.next();!d.done;d=F.next())if(S=d.value,S.offlineMusicPlaylistData){q=S.offlineMusicPlaylistData;break}U=p.playlistId;f=YUa(p);b=f.aF;N=f.Bx;y=t?(Number(t)*1E3).toString():Date.now().toString();Y=p.lastModifiedTimestamp?(Number(p.lastModifiedTimestamp)*1E3).toString():"0";T={id:g.o0(U,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:N,lastModifiedTimestampMillis:Y,addedTimestampMillis:y,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};A={id:g.o0(U,"musicAlbumRelease"),title:p.title,audioPlaylistId:U,trackCount:p.totalVideoCount,tracks:b,downloadMetadata:T.id};q&&(A.thumbnailDetails=(V=q.albumHqThumbnail)!=null?V:q.albumArtistThumbnail,A.artistDisplayName=q.albumArtistDisplayName,A.releaseDate=q.albumReleaseDate,A.contentRating={explicitType:q.albumReleaseExplicitType},A.releaseType=q.albumReleaseType);return g.n(D,jy(k.T,{mode:"readwrite",RO:!0},function(v){var w=My(v,A,"musicAlbumRelease");
v=My(v,T,"musicAlbumReleaseDownloadMetadataEntity");return g.Z4.all([w,v])}),2)}return D.return(A)})},PuL=function(k,p){this.T=k;
this.N=p},Iqa=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D;
return g.Q(function(v){switch(v.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,F=[],g.Aw(v,2),g.n(v,G79(k,q),4);case 4:F=v.Y;if((d=F)==null||!d.length){v.oY(5);break}return g.n(v,NZC(k.T,p.entityKey),5);case 5:g.Vi(v,3);break;case 2:return S=g.W9(v),U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.fz&&S.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,U,f));case 3:return b=[],g.n(v,ujJ(k.T,"musicTrack",F),7);case 7:F=v.Y;if(F.length)for(N=g.Z(F),y=N.next();!y.done;y=N.next())if(Y=y.value,T=Y.offlineVideoData,A=void 0,(A=T)==null?0:A.videoId)V=void 0,D=Number(((V=p.actionMetadata)==null?void 0:V.priority)||0)+1,b.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",T.videoId,"musicTrack",D,Ki,vN(p,T,q)));return v.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,b))}})},
XpS=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn,W,L,c,P,I,pS,q_,Fe,G,U0,Yh,E0,wT,NQ,RL,bP,M_,B4,Eb,wx,ML,Uk,h1,ze,an,Ce,fE,wv,b5,ig,ip,QQ,sL,H4,Ma;
return g.Q(function(Jj){switch(Jj.T){case 1:return t=E7(p),J=p.entityKey,q=g.uo(J).entityId,F=[],d=!1,q==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.n(Jj,Hq(k.T,"musicPlaylist"),5)):g.n(Jj,K3(k.T,J,"musicPlaylist"),4);case 4:(S=Jj.Y)&&F.push(S);Jj.oY(3);break;case 5:F=Jj.Y;case 3:if((U=F)==null||!U.length)return Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));f=g.e(p.actionMetadata,TZa);N=(b=f)==null?void 0:b.autoSync;y=[];T=Y=!0;A=!1;V=void 0;if(!d&&N===!1){Jj.oY(6);break}g.Aw(Jj,7);return g.n(Jj,
sQS(0,!!N,!0,F),9);case 9:y=Jj.Y;g.Vi(Jj,8);break;case 7:D=g.W9(Jj);if(!(D instanceof Error&&D.message==="No data")){D instanceof Error&&D.message==="Empty response body"&&JU(D.message);Jj.oY(8);break}return q==="!*$_ALL_ENTITIES_!*$"?g.n(Jj,Li(k.T,p,k.N),8):g.n(Jj,s7(q,"musicPlaylist",k.T,p,k.N),8);case 8:if(!y.length||!d&&y[0].playlistId!==q)return Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));case 6:if(d){v=[];w=g.Z(y);for(X=w.next();!X.done;X=w.next())B=X.value,B.upToDate||
N&&!B.shouldAutoSyncMetadata||!B.playlistId||(O={autoSync:N},v.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B.playlistId,"musicPlaylist",0,Ki,{musicPlaylistEntityActionMetadata:O})));return Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,v))}y.length&&(l=y[0],A=!!l.upToDate,N&&(Y=(oi=l.shouldAutoSyncMetadata)!=null?oi:!0,T=($h=l.shouldAutoSyncVideos)!=null?$h:!0,l.checkInSeconds&&(V=l.checkInSeconds)));if(A||!Y)return Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));kh=[];h=F[0];x=void 0;if(!h.downloadMetadata){Jj.oY(15);break}return g.n(Jj,K3(k.T,h.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:C=Jj.Y,x=Number((zL=(a=C)==null?void 0:a.addedTimestampMillis)!=null?zL:"0")/1E3;case 15:return g.Aw(Jj,17),g.n(Jj,G79(k,q,(AC=x)==null?void 0:AC.toString(),V),19);case 19:kh=Jj.Y;g.Vi(Jj,18);break;case 17:bJ=g.W9(Jj);if(!(bJ instanceof Error&&bJ.message==="No data")){if(bJ instanceof Error&&bJ.message==="Empty response body")JU(bJ.message);else return LS=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",KS="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",bJ instanceof g.fz&&bJ.type==="QUOTA_EXCEEDED"&&(LS="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",KS="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,LS,KS));Jj.oY(18);break}return g.n(Jj,s7(q,"musicPlaylist",k.T,p,k.N),18);case 18:if(!T)return Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t));JC=[];Yn=new Map;if((W=kh)==null?0:W.length)for(L=g.Z(kh),c=L.next();!c.done;c=L.next())P=c.value,I=P.offlineVideoData,pS=void 0,((pS=I)==null?0:pS.videoId)&&Yn.set(I.videoId,I);q_=new Map;Fe=[];if((G=h)==null?0:(U0=G.tracks)==null?0:U0.length)for(Yh=g.Z(h.tracks),E0=Yh.next();!E0.done;E0=Yh.next())if(wT=E0.value,NQ=g.uo(wT).entityId)Yn.has(NQ)?(q_.set(NQ,Yn.get(NQ)),Yn.delete(NQ)):Fe.push(NQ);bP=Number(((RL=p.actionMetadata)==null?void 0:RL.priority)||0)+1;M_=g.Z(Yn.entries());for(B4=M_.next();!B4.done;B4=
M_.next())Eb=B4.value,wx=g.Z(Eb),ML=wx.next().value,Uk=wx.next().value,h1=ML,ze=Uk,JC.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h1,"musicTrack",bP,Ki,vN(p,ze)));an=g.Z(q_.entries());for(Ce=an.next();!Ce.done;Ce=an.next())fE=Ce.value,wv=g.Z(fE),b5=wv.next().value,ig=wv.next().value,ip=b5,QQ=ig,JC.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ip,"musicTrack",bP,Ki,vN(p,QQ)));sL=g.Z(Fe);for(H4=sL.next();!H4.done;H4=sL.next())Ma=H4.value,JC.push(i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Ma,"musicTrack",0,Ki));return Jj.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,JC))}})},Rxa=function(k,p){var t,J;
return g.Q(function(q){switch(q.T){case 1:return t=E7(p),g.Aw(q,2),J=g.uo(p.entityKey).entityId,J==="!*$_ALL_ENTITIES_!*$"?g.n(q,Li(k.T,p,k.N),5):g.n(q,s7(J,"musicPlaylist",k.T,p,k.N),6);case 6:return g.n(q,yfc(k.T,p.entityKey),5);case 5:g.Vi(q,3);break;case 2:return g.W9(q),q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},G79=function(k,p,t,J){var q,F,d;
return g.Q(function(S){switch(S.T){case 1:return g.n(S,CDq([p]),2);case 2:return q=S.Y,g.n(S,BQR(k,q[0],t,J),3);case 3:return F=S.Y,d=Yv(F.thumbnailDetails),g.n(S,AU(d),4);case 4:return S.return(q[0].videos)}})},BQR=function(k,p,t,J){var q,F,d,S,U,f,b,N,y;
return g.Q(function(Y){return Y.T==1?(q=p.playlistId,F=YUa(p),d=F.aF,S=F.Bx,U=t?(Number(t)*1E3).toString():Date.now().toString(),f=p.lastModifiedTimestamp?(Number(p.lastModifiedTimestamp)*1E3).toString():"0",b={id:g.o0(q,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:f,addedTimestampMillis:U,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},N={id:g.o0(q,"musicPlaylist"),title:p.title,playlistId:q,thumbnailDetails:p.thumbnail,visibility:zx4(p),trackCount:p.totalVideoCount,
tracks:d,downloadMetadata:b.id},J&&(((y=N)==null?0:y.entityMetadata)?N.entityMetadata.nextAutoRefreshIntervalSeconds=String(J):N&&(N.entityMetadata={nextAutoRefreshIntervalSeconds:String(J)})),g.n(Y,jy(k.T,{mode:"readwrite",RO:!0},function(T){var A=My(T,N,"musicPlaylist");T=My(T,b,"musicPlaylistDownloadMetadataEntity");return g.Z4.all([A,T])}),2)):Y.return(N)})},zx4=function(k){switch(k.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},exJ=function(k,p){this.T=k;
this.N=p},gER=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T;
return g.Q(function(A){switch(A.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,F=g.e(p.actionMetadata,hxR),g.Aw(A,2),g.n(A,aqn(k,q,void 0,(d=F)==null?void 0:d.track,(S=F)==null?void 0:S.albumRelease),4);case 4:if((U=F)==null?0:U.playlistId){A.oY(5);break}return g.n(A,NZC(k.T,p.entityKey),5);case 5:g.Vi(A,3);break;case 2:return f=g.W9(A),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.fz&&f.type==="QUOTA_EXCEEDED"&&
(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,b,N));case 3:Y=Number(((y=p.actionMetadata)==null?void 0:y.priority)||0)+1;var V=(V=g.e(p.actionMetadata,hxR))?{playbackDataActionMetadata:{maximumDownloadQuality:V.maximumDownloadQuality}}:void 0;T=i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",q,"playbackData",Y,MIJ,V);return A.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t,[T]))}})},uzJ=function(k,p){var t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V;
return g.Q(function(D){switch(D.T){case 1:return t=E7(p),J=g.uo(p.entityKey),q=J.entityId,g.n(D,K3(k.T,p.entityKey,"musicTrack"),2);case 2:F=D.Y;if(!F){d=void 0;D.oY(3);break}return g.n(D,K3(k.T,F.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=D.Y;case 3:S=d;if(!F||!S)return D.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t));f=g.e(p.actionMetadata,hxR);g.Aw(D,5);return g.n(D,aqn(k,q,S.addedTimestampMillis,(b=f)==null?void 0:b.track,(N=f)==null?void 0:N.albumRelease),
7);case 7:Y=Number(((y=p.actionMetadata)==null?void 0:y.priority)||0)+1;U=i8("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q,"playbackData",Y,MIJ);g.Vi(D,6);break;case 5:T=g.W9(D);if(!(T instanceof Error&&T.message==="No data")){if(T instanceof Error&&T.message==="Empty response body")JU(T.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.fz&&T.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),D.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,A,V));D.oY(6);break}return g.n(D,Dg(q,k.T,p,k.N),6);case 6:return D.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",t,U?[U]:void 0))}})},lqc=function(k,p){var t,J;
return g.Q(function(q){switch(q.T){case 1:return t=E7(p),g.Aw(q,2),J=g.uo(p.entityKey).entityId,J==="!*$_ALL_ENTITIES_!*$"?g.n(q,Li(k.T,p,k.N),5):g.n(q,Dg(J,k.T,p,k.N),6);case 6:return g.n(q,yfc(k.T,p.entityKey),5);case 5:g.Vi(q,3);break;case 2:return g.W9(q),q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",t,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new QW("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
t))}})},aqn=function(k,p,t,J,q){var F,d,S,U,f,b;
return g.Q(function(N){switch(N.T){case 1:if(F=J){N.oY(2);break}return g.n(N,Z6a([p]),3);case 3:d=N.Y,S=d[0],F=b6W(S);case 2:return g.n(N,jbn(k,F,p,q,t),4);case 4:U=N.Y;f=U.musicTrackEntity;b=U.xt;var y=Yv(f.thumbnailDetails),Y=[];b&&(Y=Yv(b.thumbnailDetails));return g.n(N,AU(y.concat(Y)),0)}})},jbn=function(k,p,t,J,q){var F;
return g.Q(function(d){return d.T==1?(q||(q=Date.now().toString()),F={id:g.o0(t,"musicTrackDownloadMetadataEntity"),playbackData:g.o0(t,"playbackData"),addedTimestampMillis:q,videoDownloadContextEntity:g.o0(t,"videoDownloadContextEntity")},J&&(p.albumRelease=J.id),g.n(d,jy(k.T,{mode:"readwrite",RO:!0},function(S){var U=[],f=My(S,F,"musicTrackDownloadMetadataEntity");U.push(f);f=My(S,p,"musicTrack");U.push(f);J&&(S=My(S,J,"musicAlbumRelease"),U.push(S));return g.Z4.all(U)}),2)):d.T!=3?g.n(d,b8(t,"musicTrackDownloadMetadataEntity",
k.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:p,
xt:J})})},HN=function(){gW.apply(this,arguments);
this.L="musicTrack"},Ova=function(k,p,t){p=p===void 0?43200:p;
t=t===void 0?!0:t;var J=J===void 0?!1:J;var q,F;return g.Q(function(d){switch(d.T){case 1:if(!k.S.FI())return d.return([]);q=[];g.Aw(d,2);return g.n(d,sQS(p,t,J),4);case 4:q=d.Y;g.Vi(d,3);break;case 2:g.W9(d);case 3:return F=tIc(k,q,t,"musicPlaylist"),d.return(F)}})},K6S=function(){g.Wr.apply(this,arguments);
var k=this;this.events=new g.nC(this);this.ih=this.player.G();this.u3={cNb:function(){return k.T},
xs:function(){return k.xs()},
Zk:function(p){return k.Zk(p)}}},HvA=function(k){var p;
k=g.e((p=k.getWatchNextResponse())==null?void 0:p.currentVideoEndpoint,g.ub);if(k==null?0:k.playlistId)var t=k.playlistId;return t},xNc=function(k,p){var t,J,q,F;
return g.Q(function(d){if(d.T==1){t=p.clientPlaybackNonce;J={cpn:t,offlineSourceVisualElement:g.Ze(p.j6||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};p.Y&&(J.videoFmt=Number(p.Y.itag));p.C&&(J.audioFmt=Number(p.C.itag));if((q=HvA(p))&&p.videoId){var S=p.videoId;S=q!=="PPSV"?Promise.resolve(!1):k.T.Hs(S);d=g.n(d,S,3)}else d=d.oY(2);return d}d.T!=2&&(F=d.Y)&&(J.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");k.Y=t;g.qv("offlinePlaybackStarted",J);g.CS(d)})};
g.AG.prototype.WD=g.Jw(45,function(k){return this.app.WD(k)});
g.rG.prototype.WD=g.Jw(44,function(k){return g.Zm(this,9,k)});
g.r(IR,Gx);g.dT.Object.defineProperties(IR.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(k){this.T.entityMetadata=k}}});
g.r(jmS,IR);jmS.prototype.Y=function(){return[]};
g.r(OBS,IR);OBS.prototype.Y=function(){return[]};
g.r(KkC,IR);KkC.prototype.Y=function(){return[]};
g.r(HBR,IR);HBR.prototype.Y=function(){return[]};
g.r(x6R,IR);x6R.prototype.Y=function(){var k=[];this.T.alternateChannel&&k.push(this.T.alternateChannel);this.T.alternateChannelList&&k.push.apply(k,g.m(this.T.alternateChannelList));this.T.oneofChannelEntity&&k.push(this.T.oneofChannelEntity);return[].concat(g.m(new Set(k)))};
g.r(kcS,IR);kcS.prototype.Y=function(){var k=[];this.T.entryCollection&&k.push(this.T.entryCollection);return[].concat(g.m(new Set(k)))};
g.r(pZR,Gx);pZR.prototype.Y=function(){var k=[];this.T.video&&k.push(this.T.video);return[].concat(g.m(new Set(k)))};
g.r(tvC,IR);tvC.prototype.Y=function(){var k=[];this.T.parentPlaylist&&k.push(this.T.parentPlaylist);if(this.T.entries)for(var p=g.Z(this.T.entries),t=p.next();!t.done;t=p.next())k.push.apply(k,g.m((new pZR(t.value)).Y()));return[].concat(g.m(new Set(k)))};
g.r(JTJ,IR);JTJ.prototype.Y=function(){var k=[];this.T.descriptionEntity&&k.push(this.T.descriptionEntity);this.T.creators&&k.push.apply(k,g.m(this.T.creators));this.T.theBiggestFan&&k.push(this.T.theBiggestFan);return[].concat(g.m(new Set(k)))};
g.r(osC,IR);osC.prototype.Y=function(){return[]};
g.r(q8L,IR);q8L.prototype.Y=function(){return[]};
g.r(F1R,IR);F1R.prototype.Y=function(){return[]};
g.r($MK,IR);$MK.prototype.Y=function(){return[]};
g.r(dMc,IR);dMc.prototype.Y=function(){return[]};
g.r(EsW,IR);EsW.prototype.Y=function(){return[]};
g.r(S8Q,IR);S8Q.prototype.Y=function(){return[]};
g.r(UMR,IR);UMR.prototype.Y=function(){return[]};
g.r(fWS,IR);fWS.prototype.Y=function(){return[]};
g.r(bI9,IR);bI9.prototype.Y=function(){var k=[];this.T.downloadsList&&k.push(this.T.downloadsList);this.T.smartDownloadsList&&k.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&k.push(this.T.recommendedDownloadsList);this.T.refresh&&k.push(this.T.refresh);return[].concat(g.m(new Set(k)))};
g.r(NNR,Gx);NNR.prototype.Y=function(){var k=[];this.T.video&&k.push(this.T.video);this.T.playlist&&k.push(this.T.playlist);this.T.videoItem&&k.push(this.T.videoItem);this.T.playlistItem&&k.push(this.T.playlistItem);return[].concat(g.m(new Set(k)))};
g.r(yTn,IR);yTn.prototype.Y=function(){var k=[];this.T.refresh&&k.push(this.T.refresh);if(this.T.downloads)for(var p=g.Z(this.T.downloads),t=p.next();!t.done;t=p.next())k.push.apply(k,g.m((new NNR(t.value)).Y()));return[].concat(g.m(new Set(k)))};
g.r(Y8n,IR);Y8n.prototype.Y=function(){var k=[];this.T.localImageEntities&&k.push.apply(k,g.m(this.T.localImageEntities));return[].concat(g.m(new Set(k)))};
g.r(TNL,IR);TNL.prototype.Y=function(){var k=[];this.T.playbackData&&k.push(this.T.playbackData);this.T.localImageEntities&&k.push.apply(k,g.m(this.T.localImageEntities));this.T.videoDownloadContextEntity&&k.push(this.T.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.r(rTa,IR);rTa.prototype.Y=function(){return[]};
g.r(ZIW,IR);ZIW.prototype.Y=function(){var k=[];this.T.fakeChildren&&k.push.apply(k,g.m(this.T.fakeChildren));return[].concat(g.m(new Set(k)))};
g.r(CpS,IR);CpS.prototype.Y=function(){var k=[];this.T.video&&k.push(this.T.video);this.T.playbackData&&k.push(this.T.playbackData);this.T.offlineVideoPolicy&&k.push(this.T.offlineVideoPolicy);return[].concat(g.m(new Set(k)))};
g.r(ATW,IR);ATW.prototype.Y=function(){return[]};
g.r(mMC,IR);mMC.prototype.Y=function(){var k=[];this.T.channelOwner&&k.push(this.T.channelOwner);this.T.videos&&k.push.apply(k,g.m(this.T.videos));this.T.collaboratorChannels&&k.push.apply(k,g.m(this.T.collaboratorChannels));this.T.downloadState&&k.push(this.T.downloadState);this.T.refresh&&k.push(this.T.refresh);return[].concat(g.m(new Set(k)))};
g.r(Vvc,IR);Vvc.prototype.Y=function(){var k=[];this.T.video&&k.push(this.T.video);this.T.channelContributor&&k.push(this.T.channelContributor);return[].concat(g.m(new Set(k)))};
g.r(W1C,Gx);W1C.prototype.Y=function(){var k=[];this.T.localImageEntities&&k.push.apply(k,g.m(this.T.localImageEntities));this.T.videoDownloadContextEntity&&k.push(this.T.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.r(DMq,Gx);DMq.prototype.Y=function(){var k=[];this.T.recommendedVideoMetadata&&k.push.apply(k,g.m((new W1C(this.T.recommendedVideoMetadata)).Y()));return[].concat(g.m(new Set(k)))};
g.r(saC,Gx);saC.prototype.Y=function(){var k=[];this.T.playbackPosition&&k.push(this.T.playbackPosition);return[].concat(g.m(new Set(k)))};
g.r(L1K,IR);L1K.prototype.Y=function(){var k=[];this.T.owner&&k.push(this.T.owner);this.T.downloadState&&k.push(this.T.downloadState);this.T.userState&&k.push.apply(k,g.m((new saC(this.T.userState)).Y()));this.T.additionalMetadata&&k.push.apply(k,g.m((new DMq(this.T.additionalMetadata)).Y()));return[].concat(g.m(new Set(k)))};
g.r(vsa,IR);vsa.prototype.Y=function(){var k=[];this.T.userChannelDetails&&k.push(this.T.userChannelDetails);return[].concat(g.m(new Set(k)))};
g.r(cTn,IR);cTn.prototype.Y=function(){var k=[];this.T.channelOwner&&k.push(this.T.channelOwner);this.T.playbackPosition&&k.push(this.T.playbackPosition);this.T.localImageEntities&&k.push.apply(k,g.m(this.T.localImageEntities));this.T.downloadStatus&&k.push(this.T.downloadStatus);return[].concat(g.m(new Set(k)))};
g.r(nsK,IR);nsK.prototype.Y=function(){return[]};
g.r(wZL,IR);wZL.prototype.Y=function(){return[]};
g.r(iIc,IR);iIc.prototype.Y=function(){return[]};
g.r(QaJ,IR);QaJ.prototype.Y=function(){return[]};
g.r(PpA,IR);PpA.prototype.Y=function(){return[]};
g.r(GcL,IR);GcL.prototype.Y=function(){return[]};
g.r(IWA,IR);IWA.prototype.Y=function(){return[]};
g.r(XZJ,IR);XZJ.prototype.Y=function(){return[]};
g.r(Ro4,IR);Ro4.prototype.Y=function(){return[]};
g.r(BNK,IR);BNK.prototype.Y=function(){return[]};
g.r(zo9,IR);zo9.prototype.Y=function(){return[]};
g.r(eoA,IR);eoA.prototype.Y=function(){var k=[];this.T.trackDownloadMetadatas&&k.push.apply(k,g.m(this.T.trackDownloadMetadatas));return[].concat(g.m(new Set(k)))};
g.r(hoK,IR);
hoK.prototype.Y=function(){var k=[];this.T.downloadedTracks&&k.push.apply(k,g.m(this.T.downloadedTracks));this.T.smartDownloadedTracks&&k.push.apply(k,g.m(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&k.push.apply(k,g.m(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&k.push.apply(k,g.m(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&k.push.apply(k,g.m(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&k.push.apply(k,g.m(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
k.push.apply(k,g.m(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&k.push.apply(k,g.m(this.T.metadataOnlyTracks));return[].concat(g.m(new Set(k)))};
g.r(aWq,IR);aWq.prototype.Y=function(){var k=[];this.T.trackDownloadMetadatas&&k.push.apply(k,g.m(this.T.trackDownloadMetadatas));return[].concat(g.m(new Set(k)))};
g.r(Mv4,IR);Mv4.prototype.Y=function(){var k=[];this.T.playbackData&&k.push(this.T.playbackData);this.T.localImageEntities&&k.push.apply(k,g.m(this.T.localImageEntities));this.T.videoDownloadContextEntity&&k.push(this.T.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.r(gs4,IR);gs4.prototype.Y=function(){var k=[];this.T.musicLibraryStatusEntity&&k.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&k.push.apply(k,g.m(this.T.primaryArtists));this.T.details&&k.push(this.T.details);this.T.userDetails&&k.push(this.T.userDetails);this.T.tracks&&k.push.apply(k,g.m(this.T.tracks));this.T.share&&k.push(this.T.share);this.T.downloadMetadata&&k.push(this.T.downloadMetadata);this.T.refresh&&k.push(this.T.refresh);return[].concat(g.m(new Set(k)))};
g.r(un9,IR);un9.prototype.Y=function(){var k=[];this.T.albumRelease&&k.push(this.T.albumRelease);this.T.tracks&&k.push.apply(k,g.m(this.T.tracks));return[].concat(g.m(new Set(k)))};
g.r(lWc,IR);lWc.prototype.Y=function(){var k=[];this.T.albumRelease&&k.push(this.T.albumRelease);return[].concat(g.m(new Set(k)))};
g.r(jaA,IR);jaA.prototype.Y=function(){var k=[];this.T.details&&k.push(this.T.details);this.T.userDetails&&k.push(this.T.userDetails);return[].concat(g.m(new Set(k)))};
g.r(OIa,IR);OIa.prototype.Y=function(){var k=[];this.T.parentArtist&&k.push(this.T.parentArtist);return[].concat(g.m(new Set(k)))};
g.r(K19,IR);K19.prototype.Y=function(){var k=[];this.T.parentArtist&&k.push(this.T.parentArtist);return[].concat(g.m(new Set(k)))};
g.r(HI4,IR);HI4.prototype.Y=function(){return[]};
g.r(xM9,IR);xM9.prototype.Y=function(){return[]};
g.r(kR4,Gx);kR4.prototype.Y=function(){var k=[];this.T.creatorEntity&&k.push(this.T.creatorEntity);return[].concat(g.m(new Set(k)))};
g.r(p0K,IR);
p0K.prototype.Y=function(){var k=[];this.T.tracks&&k.push.apply(k,g.m(this.T.tracks));this.T.refresh&&k.push(this.T.refresh);this.T.musicLibraryStatusEntity&&k.push(this.T.musicLibraryStatusEntity);this.T.details&&k.push(this.T.details);this.T.downloadMetadata&&k.push(this.T.downloadMetadata);this.T.sideloadMetadata&&k.push(this.T.sideloadMetadata);this.T.userDetails&&k.push(this.T.userDetails);this.T.entryCollection&&k.push(this.T.entryCollection);this.T.share&&k.push(this.T.share);this.T.podcastShowAdditionalMetadata&&k.push.apply(k,
g.m((new kR4(this.T.podcastShowAdditionalMetadata)).Y()));return[].concat(g.m(new Set(k)))};
g.r(t74,IR);t74.prototype.Y=function(){return[]};
g.r(JSq,IR);
JSq.prototype.Y=function(){var k=[];this.T.musicLibraryStatusEntity&&k.push(this.T.musicLibraryStatusEntity);this.T.artists&&k.push.apply(k,g.m(this.T.artists));this.T.audioModeVersion&&k.push(this.T.audioModeVersion);this.T.videoModeVersion&&k.push(this.T.videoModeVersion);this.T.userDetails&&k.push(this.T.userDetails);this.T.details&&k.push(this.T.details);this.T.albumRelease&&k.push(this.T.albumRelease);this.T.share&&k.push(this.T.share);this.T.libraryEdit&&k.push(this.T.libraryEdit);this.T.downloadMetadata&&
k.push(this.T.downloadMetadata);this.T.playbackPosition&&k.push(this.T.playbackPosition);this.T.lyrics&&k.push(this.T.lyrics);return[].concat(g.m(new Set(k)))};
g.r(ooJ,IR);ooJ.prototype.Y=function(){var k=[];this.T.parentTrack&&k.push(this.T.parentTrack);return[].concat(g.m(new Set(k)))};
g.r(qQa,IR);qQa.prototype.Y=function(){var k=[];this.T.parentTrack&&k.push(this.T.parentTrack);return[].concat(g.m(new Set(k)))};
g.r(FB9,IR);FB9.prototype.Y=function(){return[]};
g.r($SL,IR);$SL.prototype.Y=function(){return[]};
g.r(dSc,IR);dSc.prototype.Y=function(){return[]};
g.r(EoQ,IR);EoQ.prototype.Y=function(){return[]};
g.r(SQS,IR);SQS.prototype.Y=function(){var k=[];this.T.transfer&&k.push(this.T.transfer);this.T.adsPlaybackData&&k.push.apply(k,g.m(this.T.adsPlaybackData));this.T.drmLicense&&k.push(this.T.drmLicense);this.T.offlineVideoPolicy&&k.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&k.push(this.T.videoDownloadContextEntity);return[].concat(g.m(new Set(k)))};
g.r(USS,IR);USS.prototype.Y=function(){return[]};
g.r(fRn,IR);fRn.prototype.Y=function(){var k=[];this.T.offlineVideoStreams&&k.push.apply(k,g.m(this.T.offlineVideoStreams));this.T.captionTrack&&k.push.apply(k,g.m(this.T.captionTrack));return[].concat(g.m(new Set(k)))};
g.r(bOL,IR);bOL.prototype.Y=function(){return[]};
g.r(N1K,IR);N1K.prototype.Y=function(){return[]};
g.r(ySS,IR);ySS.prototype.Y=function(){return[]};
g.r(YQa,IR);YQa.prototype.Y=function(){return[]};
g.r(T1W,IR);T1W.prototype.Y=function(){return[]};
g.r(rSS,IR);rSS.prototype.Y=function(){return[]};
g.r(ZOA,IR);ZOA.prototype.Y=function(){return[]};
g.r(Cta,IR);Cta.prototype.Y=function(){return[]};
g.r(ASJ,IR);ASJ.prototype.Y=function(){return[]};
g.r(mSQ,IR);mSQ.prototype.Y=function(){return[]};
g.r(V74,IR);V74.prototype.Y=function(){return[]};
g.r(WBa,IR);WBa.prototype.Y=function(){return[]};
g.r(DSQ,IR);DSQ.prototype.Y=function(){return[]};
g.r(sVW,IR);sVW.prototype.Y=function(){return[]};
g.r(LB9,IR);LB9.prototype.Y=function(){return[]};
g.r(voa,IR);voa.prototype.Y=function(){return[]};
g.r(cSn,IR);cSn.prototype.Y=function(){return[]};
g.r(noq,IR);noq.prototype.Y=function(){return[]};
var LyC=["browse","music/browse","unplugged/browse"],i6S=["offline/playlist_sync_check"],rfJ=["offline"],v8W=["offline/offline_video_playback_position_sync"],n8n=["offline/get_playback_data_entity"],X7;RR.getInstance=function(){return g.Q(function(k){return k.return(new Promise(function(p){g.lr().then(function(t){t?(RR.instance||(RR.instance=new RR(t)),p(RR.instance)):p(void 0)})}))})};
RR.prototype.get=function(k){var p=this,t,J,q;return g.Q(function(F){if(F.T==1)return g.n(F,Pt4(p.token),2);if(F.T!=3)return t=F.Y,g.n(F,t.get("prefs",k),3);J=F.Y;if(!J)return F.return();q=(0,g.V9)();return J.expirationTimestampMs<=q?F.return():F.return(J.value)})};
RR.prototype.set=function(k,p,t){t=t===void 0?31536E3:t;var J=this,q,F,d;return g.Q(function(S){if(S.T==1)return q=(0,g.V9)(),F={key:k,value:p,expirationTimestampMs:q+t*1E3},g.n(S,Pt4(J.token),2);d=S.Y;return g.n(S,g.c7(d,"prefs",F),0)})};
RR.prototype.remove=function(k){var p=this,t;return g.Q(function(J){if(J.T==1)return g.n(J,Pt4(p.token),2);t=J.Y;return g.n(J,t.delete("prefs",k),0)})};
g.r(Bq,g.hm);g.r(zx,B1n);zx.prototype.N=function(k,p){p=ezR(p);k=(new TextEncoder).encode(JSON.stringify(k));return this.T.encrypt(k,p)};
zx.prototype.Y=function(k,p){if(!(k instanceof Uint8Array))throw GRL(1);var t=new TextDecoder;p=ezR(p);k=this.T.decrypt(k,p);return JSON.parse(t.decode(k))};
var hza={accountLinkStatusEntity:F1R,booleanEntity:KkC,buttonEntity:V74,captionTrack:FB9,channelHandle:jmS,commerceAcquisitionClientPayloadEntity:DSQ,commerceCartListEntity:sVW,contextNoteFeedEntityPayload:OBS,continuationTokenEntity:ATW,downloadQualityPickerEntity:S8Q,downloadsPageRefreshTokenEntity:fWS,downloadsPageViewConfigurationEntity:nsK,downloadStatusEntity:UMR,dismissState:T1W,sfvAudioItemCurrentlyPlayingEntity:N1K,emojiFountainDataEntity:ASJ,emojiCustomizationSetEntity:Cta,fakeChannel:x6R,
fakePlaylist:kcS,fakePlaylistEntryCollection:tvC,fakeVideo:JTJ,fakeVideoDescription:osC,featuredProductsEntity:Ro4,flowStateEntity:q8L,iconBadgeEntity:LB9,interstitialInteractionStateEntity:dMc,likeButtonAnimationEntity:wZL,liveChatPollStateEntity:EsW,liveReactionsDataEntity:mSQ,logoEntity:$MK,macroMarkerEntity:iIc,mainDownloadsLibraryEntity:bI9,mainDownloadsListEntity:yTn,mainPlaylistDownloadStateEntity:Y8n,mainPlaylistEntity:mMC,mainPlaylistVideoEntity:Vvc,mainVideoDownloadStateEntity:TNL,mainVideoEntity:L1K,
markersEngagementPanelSyncEntity:QaJ,markersVisibilityOverrideEntity:PpA,musicAlbumReleaseDetail:un9,musicAlbumReleaseDownloadMetadataEntity:eoA,musicAlbumRelease:gs4,musicAlbumReleaseUserDetail:lWc,musicArtistDetail:OIa,musicArtist:jaA,musicArtistUserDetail:K19,musicDownloadsLibraryEntity:hoK,musicLibraryEdit:HI4,musicLibraryStatusEntity:xM9,musicPlaylist:p0K,musicPlaylistDownloadMetadataEntity:aWq,musicShare:t74,musicTrackDetail:ooJ,musicTrackDownloadMetadataEntity:Mv4,musicTrack:JSq,musicTrackUserDetail:qQa,
offlineOrchestrationActionWrapperEntity:$SL,offlineVideoPolicy:dSc,offlineVideoStreams:EoQ,offlineabilityEntity:rTa,orchestrationWebSamplingEntity:ZIW,pageHeaderEntity:rSS,pdpStateEntity:voa,pinnedProductEntity:BNK,playbackData:SQS,playerStateEntity:GcL,quantityIncrementerEntity:cSn,refresh:USS,saveToPlaylistListEntity:ySS,settingEntity:YQa,stringEntity:HBR,suggestedFeedbackChipStateEntity:IWA,transfer:fRn,trendingOfferEntity:zo9,videoDownloadContextEntity:bOL,videoOverviewAsyncDataEntity:noq,videoPlaybackPositionEntity:WBa,
votingEntity:ZOA,ytMainChannelEntity:vsa,youchatPendingResponseEntity:XZJ,ytMainDownloadedVideoEntity:CpS,ytMainVideoEntity:cTn};g.r(ue,B1n);ue.prototype.N=function(k){return k};
ue.prototype.Y=function(k){if(k instanceof Uint8Array)throw GRL(0);return k};
g.r(le,g.R);le.prototype.observe=function(k){var p=this;this.observers.push(k);return function(){var t=p.observers.indexOf(k);t>=0&&p.observers.splice(t,1)}};
le.prototype.Y=function(k){JKa(this,k.data)};
le.prototype.Ap=function(){this.channel.close()};
var dJ9,o8J=new g.V2("elementsCommand");var VW=new g.V2("entityBatchUpdate");var gcc=new g.V2("downloadStatusEntity");var dNS=new g.V2("mainPlaylistEntityActionMetadata");var jZ=new g.V2("mainVideoEntityActionMetadata");var TZa=new g.V2("musicPlaylistEntityActionMetadata");var hxR=new g.V2("musicTrackEntityActionMetadata");var VIa=new g.V2("localImageEntityActionMetadata");var PN=new g.V2("playbackDataActionMetadata");var qc9=new g.V2("transferEntityActionMetadata");var aH9=new g.V2("videoPlaybackPositionEntityActionMetadata");var V4Q;new g.yM;new g.yM;vc4.prototype.request=function(k,p,t){p=p===void 0?{}:p;return this.locks.request(k,p,function(J){return t(J)})};var tU=g.B9.caches,pi,Qp9;kv.prototype.open=function(k){return tU.open(wCC(k))};
kv.prototype.has=function(k){return tU.has(wCC(k))};
kv.prototype.delete=function(k){return tU.delete(wCC(k))};
kv.prototype.match=function(k,p){var t=this,J,q,F,d,S,U;return g.Q(function(f){switch(f.T){case 1:return g.n(f,t.keys(),2);case 2:J=f.Y,q=g.Z(J),F=q.next();case 3:if(F.done){f.oY(5);break}d=F.value;return g.n(f,t.open(d),6);case 6:return S=f.Y,g.n(f,S.match(k,p),7);case 7:if(U=f.Y)return f.return(U);F=q.next();f.oY(3);break;case 5:return f.return()}})};
g.r(nca,kv);nca.prototype.keys=function(){var k,p,t,J,q,F,d,S,U;return g.Q(function(f){if(f.T==1)return k=[],p=g.au("CacheStorage keys"),g.n(f,tU.keys(),2);t=f.Y;J=g.Z(t);for(q=J.next();!q.done;q=J.next()){F=q.value;var b=F.indexOf(":");d=b===-1?{sj:F}:{sj:F.substring(0,b),datasyncId:F.substring(b+1)};S=d.sj;U=d.datasyncId;U===p&&k.push(S)}return f.return(k)})};g.r(od,g.R);od.prototype.N=function(k){this.api.zb("onOfflineOperationFailure",k.data)};
od.prototype.C=function(k){this.api.publish("offlinetransferpause",k.data)};
od.prototype.Ap=function(){var k;(k=this.T)==null||k.close();var p;(p=this.Y)==null||p.close()};I09.prototype.y7=function(){this.T&&Fi(this)};
I09.prototype.hJ=function(){this.Y&&this.Y.resolve();this.N=this.T=!1;this.L()};var A0a=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var pUa="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var fHK="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.r(PDQ,wW);PDQ.prototype.Y=function(k){return SZ(k)?XU4(this,k):U7(k)?z8n(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.r(e8R,wW);e8R.prototype.Y=function(k){return U7(k)?h8S(this,k):M44(k)?MLK(this,k):fi(k)?g89(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.E=u2W.prototype;g.E.FW0=function(k){var p=this,t,J,q,F;return g.Q(function(d){if(!g.u(k.state,128))return d.oY(0);t=k.state.JD;var S=(J=t)==null?void 0:J.errorCode,U=(q=t)==null?void 0:q.rq;F=S==="net.connect"&&U===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(S==null?0:S.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.n(d,p.LX(p.player.getVideoData().videoId,F),0)})};
g.E.LX=function(k,p){var t=this;return g.Q(function(J){if(J.T==1){if(t.Y)return J.return();t.Y=!0;return p==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Xi(t,k,!1,!0),J.oY(0)):g.n(J,Id(t,k),3)}g.D_(k,4);return g.n(J,t.T.LX(p),0)})};
g.E.BP=function(k){k.status===2?(k.status!==this.N&&(htC(this.T),g.D_(k.videoId,2)),k.FV&&lUq(this.T,k.videoId,k.FV)):k.status===4?(Id(this,k.videoId),this.LX(k.videoId,k.DU?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):k.status===1&&uLn(this.T);this.N=k.status;this.api.zb("localmediachange",{videoId:k.videoId,status:k.status})};
g.E.Wr=function(){var k=this,p;return g.Q(function(t){if(t.T==1){if(k.Y)return t.return();k.Y=!0;p=k.player.getVideoData().videoId;return g.n(t,Id(k,p),2)}return g.n(t,k.T.Wr(),0)})};
g.E.Be=function(k){switch(k){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.E.D=function(k){return this.api.G().D(k)};g.r(kt9,wW);kt9.prototype.Y=function(k){return SZ(k)?tFJ(this,k):U7(k)?J0L(this,k):M44(k)?o_S(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};Scc.prototype.T=function(k,p){var t=k.action.actionMetadata.priority-p.action.actionMetadata.priority;t===0&&(k.T<p.T?t=-1:k.T>p.T&&(t=1));return t};g.r(Rd,g.R);Rd.prototype.Ap=function(){this.L&&this.L();g.R.prototype.Ap.call(this)};
Rd.prototype.createAction=function(k,p){var t=g.uo(k.entityKey).entityType,J=g.Zi(16);return new TV(t,J,k,p.actionId,p.rootActionId)};
Rd.prototype.Y8=function(k){var p=this,t,J,q,F,d,S,U,f,b;return g.Q(function(N){if(N.T==1){if(p.MO())return N.return();J=(t=k.offlineOrchestrationActionWrapperEntity)!=null?t:new Set;q=[];F=g.Z(J);for(d=F.next();!d.done;d=F.next())S=d.value,U=g.uo(S),f=U.entityId,b2C(p.T,f)||q.push(S);return g.n(N,WEQ(p,q),2)}b=N.Y;return g.n(N,VF4(p,b),0)})};
Rd.prototype.retry=function(){var k=this;return g.Q(function(p){return g.n(p,Dd4(k),0)})};LEq.prototype.eP=function(k,p){p=p===void 0?!0:p;var t=this,J,q,F,d,S,U,f,b;return g.Q(function(N){switch(N.T){case 1:if(!t.T)return N.return();J=[];q=g.fg(t.T.Y,p);F=[];for(d={hw:0};d.hw<q.length;d={hw:d.hw},d.hw++)S=q[d.hw],U=t.T.z3(S,"json3"),f=g.sG(U,{withCredentials:!0,format:"RAW"},3,500).then(function(y){return function(Y){Y={metadata:g.Sa(q[y.hw]),trackData:Y.xhr.responseText};F.push(Y)}}(d)).pU(function(y){JU("Caption fetch error",y)}),J.push(f);
return g.n(N,lSC(J),2);case 2:return g.Aw(N,3),g.n(N,YHQ(k,F),5);case 5:g.Vi(N,0);break;case 3:b=g.W9(N),JU("Caption DB transaction error",b),g.CS(N)}})};g.r(BN,g.R);BN.prototype.Ap=function(){this.Y&&this.Y();g.R.prototype.Ap.call(this)};
BN.prototype.N=function(k){var p=this,t,J,q,F,d,S,U,f;return g.Q(function(b){J=(t=k.transfer)!=null?t:new Set;q=[];F=g.Z(J);for(d=F.next();!d.done;d=F.next())S=d.value,U=g.uo(S),f=U.entityId,q.push(f);return q.length===0?b.return():g.n(b,n_a(p,q),0)})};g.r(GtQ,g.R);g.E=GtQ.prototype;g.E.Ap=function(){this.NO&&this.NO();this.P0.dispose();this.C.dispose();this.qO&&g.Rn(this.S.lO,this.qO);this.Oy&&g.Rn(this.S.lO,this.Oy);g.R.prototype.Ap.call(this)};
g.E.fwT=function(k){var p=this,t,J,q;return g.Q(function(F){switch(F.T){case 1:t=g.o0(k,"transfer");if(p.T&&t===p.T.key){Xi(p.Z,p.X,!0);p.C.stop();F.oY(0);break}return g.n(F,jy(p.Y,{mode:"readwrite",RO:!0},function(d){return ey(d,t,"transfer").then(function(S){if(S&&S.transferState!=="TRANSFER_STATE_COMPLETE"&&S.transferState!=="TRANSFER_STATE_FAILED")return S.transferState="TRANSFER_STATE_PAUSED_BY_USER",My(d,S,"transfer").then(function(){return S})})}),3);
case 3:J=F.Y;if(!J){F.oY(0);break}if(!k||!p.N){F.oY(5);break}return g.n(F,b8(k,p.N,p.Y,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.n(F,hU(p,k),7);case 7:q=F.Y,hkn({videoId:k,A_:J,offlineModeType:q}),g.CS(F)}})};
g.E.X3S=function(){var k=this;if(this.T&&this.X){Xi(this.Z,this.X,!1);var p=this.T,t=(p==null?0:p.key)?g.uo(p.key).entityId:"";t&&this.N&&(new Promise(function(J,q){b8(t,k.N,k.Y,"DOWNLOAD_STATE_PAUSED").catch(function(F){q(F)})})).catch(function(J){JU("Download state setting error",J)})}this.C.stop()};
g.E.VY=function(){this.T?RtS(this,this.T):eZ(this)};
g.E.rl=function(k){var p=this;return g.Q(function(t){switch(t.T){case 1:if(!p.T){t.oY(2);break}if(p.T.transferState==="TRANSFER_STATE_COMPLETE"||p.T.transferState==="TRANSFER_STATE_FAILED"||!k.transfer||!k.transfer.has(p.T.key)){t.oY(3);break}return g.n(t,K3(p.Y,p.T.key,"transfer"),4);case 4:p.T=t.Y;if(p.T){t.oY(3);break}return g.n(t,BlA(p),3);case 3:if(p.T)return t.return();case 2:return g.n(t,eZ(p),0)}})};
g.E.LX=function(k,p){var t=this,J,q,F,d,S;return g.Q(function(U){switch(U.T){case 1:if(!t.T){ad(t,"onTransferFailure: "+k);U.oY(2);break}J=t.T;F=((q=J)==null?0:q.key)?g.uo(J.key).entityId:"";a:switch(k){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var f=!1;break a;default:f=!0}return f&&jtQ(t)?g.n(U,Mt(t,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.n(U,
O2c(t,k),5);case 5:if(!F||!t.N){U.oY(2);break}return g.n(U,b8(F,t.N,t.Y,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.n(U,hU(t,F),9);case 9:d=U.Y;dW({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:F,A_:J,offlineModeType:d});if(!F||!t.N){U.oY(2);break}return g.n(U,b8(F,t.N,t.Y,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:zV(t),S=eZ(t,!0),p&&p(S),g.CS(U)}})};
g.E.Wr=function(k){var p=this,t,J,q,F,d,S,U,f,b,N,y,Y;return g.Q(function(T){switch(T.T){case 1:if(!p.T){ad(p,"onMaybeTransferStreamsExpired");T.oY(2);break}return jtQ(p)?g.n(T,Mt(p,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.n(T,O2c(p,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!p.N){T.oY(2);break}t=p.T;q=((J=t)==null?0:J.key)?g.uo(t.key).entityId:"";if(!q){T.oY(2);break}return g.n(T,b8(q,p.N,p.Y,"DOWNLOAD_STATE_FAILED"),2);case 9:return p.T||ad(p,"onMaybeTransferStreamsExpiredRetryAttempting"),
F=p.T,S=((d=F)==null?0:d.key)?g.uo(F.key).entityId:"",g.n(T,hU(p,S),10);case 10:return U=T.Y,dW({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:S,A_:F,offlineModeType:U}),f=jpC(),g.Il(f,PN,{isEnqueuedForExpiredStreamUrlRefetch:!0}),b=g.o0(S,"playbackData"),N={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:b,actionMetadata:f},y=Zg(new TV("playbackData",S,N)),g.n(T,Oz(p.Y,y,"offlineOrchestrationActionWrapperEntity"),2);case 2:zV(p),Y=eZ(p,!0),
k&&k(Y),g.CS(T)}})};
var ky9={},KES=(ky9.TRANSFER_STATE_TRANSFERRING=1,ky9.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,ky9);g.E=gW.prototype;g.E.gt=function(){return this.X.promise};
g.E.v_=function(){if(this.Y&&this.Z)return this.X.promise;k7q(this).then(this.X.resolve).catch(this.X.reject);return this.X.promise};
g.E.ME=function(k){var p={};return p.playbackData=new PDQ(k,this.ih,this.T),p.transfer=new kt9(k,this.ih),p.videoPlaybackPositionEntity=new e8R(k,this.ih),p};
g.E.Ln=function(){var k=this;return g.Q(function(p){return k.Y?g.n(p,IUR(k.Y),0):p.oY(0)})};
g.E.dL=function(){var k=this,p,t;return g.Q(function(J){if(J.T==1)return k.Y||k.Z?g.n(J,k.gt(),2):J.return();k.B!==void 0&&(g.yI(k.B),k.B=void 0);k.C!==void 0&&(g.yI(k.C),k.C=void 0);(p=k.Y)==null||p.dispose();k.Y=void 0;(t=k.Z)==null||t.dispose();k.Z=void 0;k.api.zb("onOrchestrationLostLeader");k.X=new g.yM;g.CS(J)})};
g.E.isOrchestrationLeader=function(){return this.N.T};
g.E.Hs=function(){return g.Q(function(k){return k.return(!1)})};
g.E.Pw=function(k){var p=this.T;p.api.publish("offlinetransferpause",k);var t;(t=p.Y)==null||t.postMessage(k)};
g.E.VY=function(k){var p,t;return g.Q(function(J){if(J.T==1)return g.n(J,xV(),2);p=J.Y;if(!p)return J.return();t=g.o0(k,"transfer");return g.n(J,jy(p,{mode:"readwrite",RO:!0},function(q){var F=ey(q,t,"transfer"),d=ey(q,g.o0(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Z4.all([F,d]).then(function(S){S=g.Z(S);var U=S.next().value;var f=S.next().value;return U&&U.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(U.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",My(q,U,"transfer").then(function(){dW({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:k,A_:U,offlineModeType:f==null?void 0:f.offlineModeType});return g.Z4.resolve(null)})):g.Z4.resolve(null)})}),0)})};
g.E.Ia=function(k){k=k===void 0?43200:k;var p=this,t,J,q,F,d,S,U,f;return g.Q(function(b){if(b.T==1)return p.S.FI()?g.n(b,xV(),2):b.return(pp4());if(b.T!=3){t=b.Y;if(!t)return b.return([]);J=Date.now()/1E3;return g.n(b,Hq(t,"offlineVideoPolicy"),3)}q=b.Y;F=[];d=g.Z(q);for(S=d.next();!S.done;S=d.next())U=S.value,Number(U.lastUpdatedTimestampSeconds)+k<=J&&(f=g.uo(U.key).entityId,F.push(f));return F.length?b.return(u8(p,F,p.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):b.return([])})};
g.E.deleteAll=function(){return u8(this,["!*$_ALL_ENTITIES_!*$"],this.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.E.refreshAllStaleEntities=function(k){var p=this;return g.Q(function(t){return t.T==1?g.n(t,p.Ia(k),2):t.return(t.Y)})};
g.E.setUpPositionSyncInterval=function(k){var p=this;this.C!==void 0&&(g.yI(this.C),this.C=void 0);var t=k!=null?k:864E5;this.C=g.b6(function(){p.M6(t)},t)};
g.E.M6=function(k){var p=this,t,J,q,F,d,S;return g.Q(function(U){switch(U.T){case 1:return g.Aw(U,2),g.n(U,RR.getInstance(),4);case 4:t=U.Y;if(!t)throw Error("prefStorage is undefined");return g.n(U,t.get("psi"),5);case 5:J=U.Y;F=((q=J)==null?0:q.Of)?Number(J.Of)/1E3:0;d=Date.now();if(!(F+k<=d)){U.oY(6);break}return g.n(U,u8(p,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Vi(U,0);break;case 2:S=g.W9(U),JU("Offline manager error",S),
g.CS(U)}})};
g.E.UI=function(){var k=this,p,t,J,q,F,d,S;return g.Q(function(U){if(U.T==1)return g.n(U,xV(),2);if(U.T!=3)return(p=U.Y)?g.n(U,Hq(p,"transfer"),3):U.return([]);t=U.Y;J=[];q=g.Z(t);for(F=q.next();!F.done;F=q.next())d=F.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(S=g.uo(d.key).entityId,J.push(S));return U.return(JBc(k,J))})};
g.E.t2=function(){return g.Q(function(k){return k.return([])})};
g.E.HE=function(){return g.Q(function(k){g.CS(k)})};
g.E.gU=function(){return g.Q(function(k){g.CS(k)})};g.r(oEC,wW);oEC.prototype.Y=function(k){return SZ(k)?$Na(this,k):U7(k)?EEW(this,k):fi(k)?SiS(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var l8=[10];g.r(yBa,wW);yBa.prototype.Y=function(k){return SZ(k)?rBq(this,k):U7(k)?ZvS(this,k):fi(k)?CuR(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var TQS=[10];g.r(mNq,wW);mNq.prototype.Y=function(k){return U7(k)?W6c(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};g.r(DNA,gW);g.E=DNA.prototype;g.E.ME=function(k){var p=gW.prototype.ME.call(this,k);p.mainVideoEntity=new yBa(k,this.ih,this.T);p.mainPlaylistEntity=new oEC(k,this.ih,this.T);p.mainDownloadsListEntity=new mNq(k,this.ih,this.T);return p};
g.E.refreshAllStaleEntities=function(k,p){var t=this,J,q,F,d,S,U,f,b,N,y,Y;return g.Q(function(T){switch(T.T){case 1:J=[];if(!t.ih.D("web_player_offline_playlist_auto_refresh")){T.oY(2);break}return g.n(T,sbq(t,k,p),3);case 3:J=T.Y;case 2:return g.n(T,RR.getInstance(),4);case 4:return q=T.Y,g.n(T,(F=q)==null?void 0:F.get("sdois"),5);case 5:return d=T.Y,g.n(T,(S=q)==null?void 0:S.get("lmqf"),6);case 6:U=T.Y;if(!d){T.oY(7);break}b=J;N=b.concat;return g.n(T,L6S(t,d,(f=U)!=null?f:"SD",k===0),8);case 8:J=
N.call(b,T.Y);case 7:return y=J,Y=y.concat,g.n(T,gW.prototype.refreshAllStaleEntities.call(t,k,p),9);case 9:return J=Y.call(y,T.Y),T.return(J)}})};
g.E.Hs=function(k){var p,t,J,q,F,d,S,U;return g.Q(function(f){if(f.T==1)return g.n(f,xV(),2);if(f.T!=3)return(p=f.Y)?g.n(f,K3(p,g.Py,"mainDownloadsListEntity"),3):f.return(!1);t=f.Y;if((J=t)==null?0:(q=J.downloads)==null?0:q.length)for(F=g.o0(k,"mainVideoEntity"),d=g.Z(t.downloads),S=d.next();!S.done;S=d.next())if(U=S.value,U.videoItem===F)return f.return(!0);return f.return(!1)})};
g.E.t2=function(){var k=this,p,t,J,q,F,d,S,U;return g.Q(function(f){if(f.T==1)return g.n(f,xV(),2);if(f.T!=3)return(p=f.Y)?g.n(f,Hq(p,"downloadStatusEntity"),3):f.return([]);t=f.Y;J=[];q=g.Z(t);for(F=q.next();!F.done;F=q.next())d=F.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(S=g.uo(d.key).entityId,J.push(S));return J.length?(U={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},f.return(u8(k,J,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
U))):f.return([])})};
g.E.gU=function(){var k;return g.Q(function(p){return p.T==1?g.n(p,xV(),2):(k=p.Y)?g.n(p,jy(k,{mode:"readwrite",RO:!0},function(t){return h8(t,"mainVideoEntity").then(function(J){var q=[];J=g.Z(J);for(var F=J.next();!F.done;F=J.next()){F=F.value;var d=void 0;(d=F.userState)!=null&&d.playbackPosition||(d=g.uo(F.key).entityId,d={key:g.o0(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},q.push(My(t,d,"videoPlaybackPositionEntity")),F.userState={playbackPosition:d.key},q.push(My(t,
F,"mainVideoEntity")))}return g.Z4.all(q)})}),0):p.return()})};
g.E.HE=function(){var k,p,t,J,q,F,d,S,U,f,b,N,y,Y,T,A,V,D,v,w,X,B,O,l,oi,$h,kh,h,x,C,a,zL,AC,bJ,LS,KS,JC,Yn;return g.Q(function(W){if(W.T==1)return g.n(W,xV(),2);if(W.T!=3){k=W.Y;if(!k)return W.return();p=g.o0("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.n(W,jy(k,{mode:"readonly",RO:!0},function(L){return g.Z4.all([ey(L,p,"mainDownloadsListEntity"),ey(L,g.Py,"mainDownloadsListEntity"),h8(L,"mainVideoEntity"),h8(L,"mainPlaylistEntity")])}),3)}t=W.Y;
J=g.Z(t);q=J.next().value;F=J.next().value;d=J.next().value;S=J.next().value;U=q;f=F;b=d;N=S;y=new Set;if((Y=U)==null?0:(T=Y.downloads)==null?0:T.length)for(A=g.Z(U.downloads),V=A.next();!V.done;V=A.next())D=V.value,v=void 0,(w=(v=D.videoItem)!=null?v:D.playlistItem)&&y.add(w);if((X=f)==null?0:(B=X.downloads)==null?0:B.length)for(O=g.Z(f.downloads),l=O.next();!l.done;l=O.next())oi=l.value,oi.videoItem&&y.add(oi.videoItem);$h=new Set;kh=[];h=g.Z(N);for(x=h.next();!x.done;x=h.next()){C=x.value;if(C.videos)for(a=
g.Z(C.videos),zL=a.next();!zL.done;zL=a.next())AC=zL.value,(bJ=JSON.parse(g.uo(AC).entityId).videoId)&&$h.add(bJ);C.key&&!y.has(C.key)&&kh.push(C.key)}LS=g.Z(b);for(KS=LS.next();!KS.done;KS=LS.next())JC=KS.value,JC.key&&!y.has(JC.key)&&(Yn=g.uo(JC.key).entityId,$h.has(Yn)||kh.push(JC.key));return kh.length?g.n(W,dRa(k,kh),0):W.oY(0)})};g.r(vES,wW);vES.prototype.Y=function(k){return SZ(k)?nER(this,k):U7(k)?wpA(this,k):fi(k)?ivA(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var O7=[10];g.r(PuL,wW);PuL.prototype.Y=function(k){return SZ(k)?Iqa(this,k):U7(k)?XpS(this,k):fi(k)?Rxa(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var Ki=[10];g.r(exJ,wW);exJ.prototype.Y=function(k){return SZ(k)?gER(this,k):U7(k)?uzJ(this,k):fi(k)?lqc(this,k):Promise.reject(Error("Unsupported action type: "+k.actionType))};
var MIJ=[10];g.r(HN,gW);HN.prototype.ME=function(k){var p=gW.prototype.ME.call(this,k);p.musicTrack=new exJ(k,this.T);p.musicPlaylist=new PuL(k,this.T);p.musicAlbumRelease=new vES(k,this.T);return p};
HN.prototype.refreshAllStaleEntities=function(k,p){var t=this,J,q,F;return g.Q(function(d){if(d.T==1)return g.n(d,Ova(t,k,p),2);if(d.T!=3)return q=J=d.Y,F=q.concat,g.n(d,gW.prototype.refreshAllStaleEntities.call(t,k,p),3);J=F.call(q,d.Y);return d.return(J)})};g.r(K6S,g.Wr);g.E=K6S.prototype;g.E.create=function(){var k=this;g.z(this,this.events);g.Mu(this.ih)?this.T=new DNA(this.ih,this.player):g.Qj(this.ih)&&(this.T=new HN(this.ih,this.player));this.events.V(this.player,"onPlaybackStartExternal",function(){k.xs()});
this.events.V(this.player,"videodatachange",function(){k.xs()});
this.ih.D("html5_offline_playback_position_sync")&&this.events.V(this.player,"presentingplayerstatechange",this.Zk)};
g.E.C5=function(){return!1};
g.E.MI=function(k,p,t,J){var q=this;return g.Q(function(F){return q.T?F.return(u8(q.T,k,p,t,J)):F.return(Promise.reject())})};
g.E.deleteAll=function(){return this.T.deleteAll()};
g.E.Ia=function(k){return this.T.Ia(k)};
g.E.refreshAllStaleEntities=function(k){return this.T.refreshAllStaleEntities(k)};
g.E.setUpPositionSyncInterval=function(k){this.T.setUpPositionSyncInterval(k)};
g.E.Pw=function(k){this.T.Pw(k)};
g.E.VY=function(k){return this.T.VY(k)};
g.E.xs=function(){var k=this,p;return g.Q(function(t){p=k.player.getVideoData();return g.lE(p)?HvA(p)&&k.Y!==p.clientPlaybackNonce?g.n(t,xNc(k,p),0):t.oY(0):t.return()})};
g.E.Zk=function(k){var p=this,t,J,q,F,d,S,U;return g.Q(function(f){if(f.T==1)return t=p.player.getVideoData(),J=t.W0,g.Uy(k,2)||g.Uy(k,512)?g.n(f,xV(),2):f.return();if(f.T!=3){q=f.Y;if(!q)return JU("PES is undefined"),f.return();F=t.videoId;return g.n(f,K3(q,g.o0(F,"mainVideoEntity"),"mainVideoEntity"),3)}d=f.Y;if(!d)return f.return();S=Math.floor(J).toString();U={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:S}};return g.n(f,p.MI([F],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
U),0)})};
g.E.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.E.updateDownloadState=function(k,p){var t,J,q,F;return g.Q(function(d){if(d.T==1)return g.n(d,xV(),2);t=d.Y;if(!t)return JU("PES is undefined"),d.return();J=g.uo(k);q=J.entityType;F=J.entityId;return g.n(d,b8(F,q,t,p,!0),0)})};g.Vc("offline",K6S);})(_yt_player);
